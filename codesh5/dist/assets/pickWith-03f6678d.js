import"./el-tag-56496b10.js";import{E as le}from"./el-overlay-0ca9246d.js";import{_ as ie,k as ce,p as h,l as de,Z as re,s as W,o as w,q as ue,x as V,y as K,a as i,z as g,F as o,A as Y,G as R,N as X,H as pe,a1 as me,D as he,E as _e,I as fe,a2 as ge}from"./index-7ad4752d.js";import{C as we,R as ve}from"./index-3d4c7514.js";import{E as be,a as ye}from"./el-select-ab6db4a7.js";import"./el-popper-6266427f.js";import{C as ke}from"./index-26753d2d.js";import"./index-1c65cf2d.js";import{F as Fe}from"./index-f4c47f9e.js";import{E as Ce,a as xe}from"./el-table-column-44cf2d59.js";import{N as Be}from"./index-d7f0187b.js";import{B as F}from"./bignumber-266e6c56.js";import{c as Z,b as ze,s as Te}from"./pickWith-1b0325a9.js";import{_ as De,a as He}from"./btn_shoudong-07961c15.js";import{_ as Ee}from"./btn_tichu-bca5bbb8.js";import{s as U,a as _}from"./function-call-63bccc74.js";import{s as Re,a as Ie,c as J}from"./index-6a3a1558.js";import{F as Se}from"./index-c6e5359e.js";import"./index-22004baa.js";import"./use-global-config-98ac7746.js";import"./objects-8d85df12.js";import"./index-4e11758a.js";import"./use-id-c21c8892.js";import"./mount-component-b771f396.js";import"./request-352f5424.js";const Le={setup(){const b=ce(),n=h([]),y=de(),t=h(""),j=h(""),v=h("0"),D=h(""),H=h("0"),z=h("0"),I=h("0"),T=h(!1),E=h(""),C=h(""),A=h(""),q=h(""),x=re({barCodeSelectList:[]});W.await("scanner",e=>{if(b.currentRoute.value.path=="/pickWith")if(e!="null"){let a=e;if(new RegExp(/^124010[1-9][0-9]{2}(0[1-9]|1[0-2])((0[1-9])|((1|2)[0-9])|30|31)[0-9]{12}$/).test(a)&&a.length===25){let c={};c.fBarcode=a,Z(c).then(l=>{if(l.data.data)return S(a).then(u=>{let p=u.shengchanriqi,m=u.kunxuhao,k=u.barcode,B=u.kunjingzhong,N={date:p,number:m,barcode:k,weight:B};L(w(n.value),N)});{let u="",p=!0;l.data.distinguish=="1"?u='<span style="font-size: 18px;color: red">'+l.data.message+"</span>":l.data.distinguish=="2"?u='<span style="font-size: 18px;color: #0e80d2">'+l.data.message+"</span>":l.data.distinguish=="4"?(p=!1,U({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">'+l.data.message+"</span>"}).then(()=>S(a).then(m=>{let k=m.shengchanriqi,B=m.kunxuhao,N=m.barcode,G=m.kunjingzhong,se={date:k,number:B,barcode:N,weight:G};L(w(n.value),se)})).catch(m=>{console.log(m)})):u='<span style="font-size: 18px">'+l.data.message+"</span>",p&&_({title:"提示",width:"600",allowHtml:!0,message:u}).then(()=>{})}})}else _({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">对不起，此条码不符合规范</span>'}).then(()=>{})}else _({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">数据获取失败</span>'}).then(()=>{})});const M=()=>{b.push({path:"/pickWithQueryInfoData"})},P=()=>{T.value=!1},O=()=>{T.value=!0};let s="";const $=(e,a,d)=>{s=w(e)},ee=()=>{W.scan()};ue(()=>{W.register("goback",()=>{b.push({path:"/pickWithQueryInfoData"})});let e=w(y.state.chukudanListInfo);w(y.state.carInfo.pizhong)&&(H.value=w(y.state.carInfo.pizhong).toFixed(4)),j.value=new F(e.F_PLANSUTTLE).minus(e.F_SUTTLE).toFixed(4),D.value=new F(e.F_PLANSUTTLE).minus(e.F_SUTTLE).toFixed(4),I.value=new F(H.value).plus(v.value).toFixed(4)});const te=()=>{if(C.value=="")return _({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">请选择条形码</span>'}).then(()=>{}),!1;T.value=!1;let e=C.value;if(new RegExp(/^124010[1-9][0-9]{2}(0[1-9]|1[0-2])((0[1-9])|((1|2)[0-9])|30|31)[0-9]{12}$/).test(e)&&e.length===25){let r={};r.fBarcode=e,Z(r).then(c=>{if(c.data.data)return S(e).then(l=>{let u=l.shengchanriqi,p=l.kunxuhao,m=l.barcode,k=l.kunjingzhong,B={date:u,number:p,barcode:m,weight:k};L(w(n.value),B)});{let l="",u=!0;c.data.distinguish=="1"?l='<span style="font-size: 18px;color: red">'+c.data.message+"</span>":c.data.distinguish=="2"?l='<span style="font-size: 18px;color: #0e80d2">'+c.data.message+"</span>":c.data.distinguish=="4"?(u=!1,U({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">'+c.data.message+"</span>"}).then(()=>S(e).then(p=>{let m=p.shengchanriqi,k=p.kunxuhao,B=p.barcode,N=p.kunjingzhong,G={date:m,number:k,barcode:B,weight:N};L(w(n.value),G)})).catch(p=>{console.log(p)})):l='<span style="font-size: 18px">'+c.data.message+"</span>",u&&_({title:"提示",width:"600",allowHtml:!0,message:l}).then(()=>{})}})}else _({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">对不起，此条码不符合规范</span>'}).then(()=>{})},ae=e=>{C.value="";let d={strBatchno:e.F_BATCHNUMBER+"-"+e.F_BATCHGROUP};ze(d).then(r=>{x.barCodeSelectList=r.data.data,x.barCodeSelectList.length>0?Re({message:"数据查询成功",type:"success",className:"particulars-detail-popup",overlay:!0}):_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">没有查询到对应的条码数据</span>'}).then(()=>{})}).catch(r=>{console.log(r)})},oe=()=>{s?U({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">是否要剔除当前所选数据？</span>'}).then(()=>{let e=n.value.filter(a=>a.barcode!=s.barcode);n.value=e,E.value="edit",Q(e,s),s=""}).catch(e=>{console.log(e)}):_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">请选择要剔除的的数据</span>'}).then(()=>{})},ne=()=>{if(n.value.length==0)return _({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">没有要处理的数据</span>'}).then(()=>{}),!1;U({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">是否已完成扫描？</span>'}).then(()=>{Ie({duration:0,forbidClick:!0,overlay:!0,className:"particulars-detail-popup",message:"拣配中..."});let e=w(y.state.chukudanListInfo),a=w(y.state.carInfo),d={};d.F_DELIVERYNO=e.F_DELIVERYNO,d.strSuttle=v.value,d.strTruckNo=a.chehao,d.weighthousename=a.chengfang,d.id=a.danjuhao,a.DataId?d.strDataId=a.DataId:d.strDataId="";let r=w(n.value).map(c=>c.barcode+",").join("");d.strBarcodes=r.substring(0,r.length-1),Te(d).then(c=>{J(),c.data.code=="200"?(n.value=[],_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">'+c.data.message+"</span>"}).then(()=>{y.commit("setPickWithScroll",0),y.commit("setChukudanListInfo",{}),y.commit("setCarInfo",{}),b.push({path:"/pickWithQueryListData"})})):_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">'+c.data.message+"</span>"}).then(()=>{})})}).catch(e=>{console.log(e),J()})},Q=(e,a)=>{E.value=="add"?v.value=new F(v.value).plus(new F(a.weight).dividedBy(1e3).toNumber()).toFixed(4):v.value=new F(v.value).minus(new F(a.weight).dividedBy(1e3).toNumber()).toFixed(4),D.value=new F(j.value).minus(v.value).toFixed(4),I.value=new F(H.value).plus(v.value).toFixed(4),z.value=e.length,n.value=e,t.value=Math.random(),D.value<0&&_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">缺少数值已为负数</span>'}).then(()=>{})},S=e=>{let a=e.split("");const d=a.slice(0,3).join(""),r=a.slice(3,5).join(""),c=a.slice(5,7).join(""),l=a.slice(7,13).join(""),u=a.slice(13,17).join(""),p=a.slice(17,20).join(""),m=a.slice(20,24).join("")+"."+a[24];return new Promise((k,B)=>{k({barcode:e,qiyedaima:d,chanpinleibie:r,chanpindengji:c,shengchanriqi:l,chanpinpihao:u,kunxuhao:p,kunjingzhong:m})})},L=(e,a)=>{if(e.find(r=>r.barcode===a.barcode))_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">该批次已经选择，请勿重复选择</span>'}).then(()=>{});else{let r=[];e.unshift(a),r=e,E.value="add",Q(r,a)}};return{typeName:E,barCodeSelect:C,F_BATCHGROUP:A,F_BATCHNUMBER:q,listData:x,itemKey:t,yingj:j,yij1:v,ques:D,pizhong:H,yij2:z,pz:I,tableData:n,centerDialogVisibleTXM:T,passedTXMClick:te,onSubmit:ae,closeTXMClick:P,checkIfExist:L,decode:S,scanCode:ee,onClickLeft:M,onHandle:O,onConfirm:ne,selectRow:$,onDelete:oe}}},f=b=>(he("data-v-ccfd707e"),b=b(),_e(),b),Ne={class:"container"},je={class:"info-container"},Ve=f(()=>o("span",{class:"title"},"应拣",-1)),Ue=f(()=>o("span",{class:"title"},"已拣",-1)),Ae=f(()=>o("span",{class:"title"},"缺少",-1)),qe=f(()=>o("span",{class:"title"},"皮重",-1)),Me=f(()=>o("span",{class:"title"},"捆数",-1)),Pe=f(()=>o("span",{class:"title"},"合计",-1)),Oe={class:"btn-area"},Ge=f(()=>o("img",{src:De},null,-1)),We=f(()=>o("div",null,"确认",-1)),Xe=[Ge,We],Qe=f(()=>o("img",{src:He},null,-1)),Ke=f(()=>o("div",null,"手动",-1)),Ye=[Qe,Ke],Ze=f(()=>o("img",{src:Ee},null,-1)),Je=f(()=>o("div",null,"剔除",-1)),$e=[Ze,Je],et={style:{margin:"16px"}},tt={style:{"margin-top":"10px"}},at=f(()=>o("p",null,"条形码",-1));function ot(b,n,y,t,j,v){const D=fe,H=Be,z=xe,I=Ce,T=Fe,E=ke,C=ge,A=be,q=ye,x=we,M=ve,P=Se,O=le;return V(),K("main",null,[i(H,{title:"拣配",class:"page-nav-bar","left-arrow":"",onClickLeft:t.onClickLeft},{right:g(()=>[i(D,{onClick:t.scanCode,style:{color:"#FFFFFF"},name:"scan",size:"40"},null,8,["onClick"])]),_:1},8,["onClickLeft"]),o("div",Ne,[(V(),Y(I,{data:t.tableData,style:{height:"260px"},id:"data-area1",key:t.itemKey,"highlight-current-row":"",onRowClick:t.selectRow},{default:g(()=>[i(z,{fixed:"",prop:"date",label:"日期"}),i(z,{prop:"number",label:"包号"}),i(z,{prop:"weight",label:"重量"}),i(z,{prop:"barcode",label:"条码",width:"250"})]),_:1},8,["data","onRowClick"])),o("div",je,[Ve,Ue,Ae,o("span",null,R(t.yingj),1),o("span",null,R(t.yij1),1),o("span",null,R(t.ques),1),qe,Me,Pe,o("span",null,R(t.pizhong),1),o("span",null,R(t.yij2),1),o("span",null,R(t.pz),1)]),o("div",Oe,[o("div",{onClick:n[0]||(n[0]=(...s)=>t.onConfirm&&t.onConfirm(...s))},Xe),o("div",{onClick:n[1]||(n[1]=(...s)=>t.onHandle&&t.onHandle(...s))},Ye),o("div",{onClick:n[2]||(n[2]=(...s)=>t.onDelete&&t.onDelete(...s))},$e)])]),i(O,{modelValue:t.centerDialogVisibleTXM,"onUpdate:modelValue":n[6]||(n[6]=s=>t.centerDialogVisibleTXM=s),title:"手动不合格条码",width:"96%","align-center":""},{default:g(()=>[i(P,{onSubmit:t.onSubmit},{default:g(()=>[i(E,{inset:""},{default:g(()=>[i(T,{modelValue:t.F_BATCHGROUP,"onUpdate:modelValue":n[3]||(n[3]=s=>t.F_BATCHGROUP=s),name:"F_BATCHGROUP",label:"批次号",placeholder:"批次号(四位)",rules:[{required:!0,message:"请填写批次号"}]},null,8,["modelValue"]),i(T,{modelValue:t.F_BATCHNUMBER,"onUpdate:modelValue":n[4]||(n[4]=s=>t.F_BATCHNUMBER=s),name:"F_BATCHNUMBER",label:"编号",placeholder:"编号(三位)",rules:[{required:!0,message:"请填写编号"}]},null,8,["modelValue"])]),_:1}),o("div",et,[i(C,{square:"",icon:"search",block:"",type:"primary","native-type":"submit",style:{"background-color":"#003363",color:"#FFFFFF"}},{default:g(()=>[X(" 查询 ")]),_:1}),o("div",tt,[at,i(q,{modelValue:t.barCodeSelect,"onUpdate:modelValue":n[5]||(n[5]=s=>t.barCodeSelect=s),placeholder:"条形码",style:{width:"100%"}},{default:g(()=>[(V(!0),K(pe,null,me(t.listData.barCodeSelectList,s=>(V(),Y(A,{key:s.F_BARCODE,label:s.F_BARCODE,value:s.F_BARCODE},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),i(M,{style:{"margin-top":"15px"}},{default:g(()=>[i(x,{span:"2"}),i(x,{span:"10"},{default:g(()=>[i(C,{icon:"passed",style:{"background-color":"#003363",color:"#FFFFFF"},onClick:t.passedTXMClick},{default:g(()=>[X("确定 ")]),_:1},8,["onClick"])]),_:1}),i(x,{span:"10",style:{"text-align":"center"}},{default:g(()=>[i(C,{icon:"close",style:{"background-color":"red",color:"#FFFFFF"},onClick:t.closeTXMClick},{default:g(()=>[X(" 退出 ")]),_:1},8,["onClick"])]),_:1}),i(x,{span:"2"})]),_:1})])]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"])])}const Dt=ie(Le,[["render",ot],["__scopeId","data-v-ccfd707e"]]);export{Dt as default};
