import{_ as T,u as z,E as A,r as i,H as Z,I as Y,o as G,b as w,c as R,i as t,d as r,w as c,J as V,N as Q,X,S as K,U as C,j as v,F as B,O as P,e as O,f as W,Y as $,a3 as ee,a4 as te,a0 as ae,a1 as oe,p as le,h as ne}from"./index-f6cc9116.js";import{E as se}from"./el-card-ab4e569d.js";/* empty css              */import"./el-tag-bb37520c.js";import{E as ie,a as re}from"./el-select-55a3a224.js";import"./el-popper-bc5dd8e2.js";/* empty css              *//* empty css              */import{d as de,g as ce,b as pe,e as ue}from"./gradeDetermination-cb4559ff.js";import"./index-b8ca38d9.js";function _e(_){let n=_.split(","),f=n[0].match(/:(.*?);/)[1],e=atob(n[1]),h=e.length,I=new Uint8Array(h);for(;h--;)I[h]=e.charCodeAt(h);let D=Math.random().toString(36).slice(-8),m=f.split("/")[1];return new File([I],D+"."+m,{type:f})}const me={setup(){const _=z(),n=A(),f=i(""),e=i(""),h=i(""),I=i(""),D=i(""),m=i(""),g=i([]),x=i([]),y=i([]),L=i(!1),N=i(!1),j=i([]),u=Z({yjtJyInformationData:{},typeCodeList:[],alterReasonList:[]});u.yjtJyInformationData=JSON.parse(decodeURIComponent(n.query.yjtJyInformation));const S=i(JSON.parse(decodeURIComponent(n.query.exterior))),J=i(JSON.parse(decodeURIComponent(n.query.tabIndex)));Y.await("takePhoto",o=>{if(o!="null"){let s={};s.index=g.value.length+1,s.base64Img=o,g.value.push(s),x.value.push(o);let a=new FormData,d="/cathodeCopper/"+u.yjtJyInformationData.batchgroup+"/"+u.yjtJyInformationData.batchnumber;a.append("file",_e(o)),a.append("path",d),de(a).then(b=>{let k={};k.fileName=b.data.fileName,k.fileUrl=b.data.fileUrl,k.index=g.value.length,y.value.push(k)}).catch(b=>{console.log(b)})}});const l=()=>{Y.takePhoto()},U=(o,s)=>{y.value=y.value.filter(a=>a.index!=o),g.value=g.value.filter(a=>a.index!=o),x.value=x.value.filter(a=>a!=s)},F=()=>{j.value=x.value,L.value=!0};S.value=="1"?(f.value="qualified",e.value="合格品类型"):S.value=="2"&&(f.value="unqualified",e.value="不合格品类型"),G(()=>{E(f.value),M()});const q=()=>{_.back()},H=()=>{if(y.value.length==0)return V({message:"请上传质检照片",type:"fail",className:"particulars-detail-popup"}),!1;if(J.value==1&&!I.value)return V({message:"请选择或者填写改判理由",type:"fail",className:"particulars-detail-popup"}),!1;let o={data:[],active:"",exterior:"",remarks:"",alterReason:"",typeCodeChecked:"",fileList:[],labelFileList:[]},s=[];s.push(u.yjtJyInformationData),o.data=s,o.typeCodeChecked=D.value,o.active=J.value,o.exterior=S.value,o.remarks=h.value,o.alterReason=I.value,o.fileList=y.value,ue(o).then(a=>{a.data.code==200&&(V({message:"质检成功",type:"success",className:"particulars-detail-popup",overlay:!0}),_.back())}).catch(a=>{console.log(a)})},E=o=>{let s={};s.typeCode=o,ce(s).then(a=>{a.data.code==200&&(u.typeCodeList=a.data.data,D.value=String(u.typeCodeList[0].id))}).catch(a=>{console.log(a)})},M=()=>{let o={},s={},a={};a.limit=9999,a.offset=1,a.blockId="paramBlock",a.data={},s.paramBlock=a,o.blocks=s,pe(o).then(d=>{u.alterReasonList=d.data.blocks.resultBlock.data}).catch(d=>{console.log(d)})};return{imgList:j,showImage:L,showLabelImage:N,fileList:g,base64ImgList:x,imagePath:y,takePhotoState:m,alterReason:I,remarks:h,typeCode:f,typeCodeText:e,listData:u,exterior:S,tabIndex:J,typeCodeChecked:D,seeImg:F,takePhotoZJ:l,onClickLeft:q,dateFormat:(o,s)=>{let a,d=new Date(s);const b={"Y+":d.getFullYear().toString(),"m+":(d.getMonth()+1).toString(),"d+":d.getDate().toString(),"H+":d.getHours().toString(),"M+":d.getMinutes().toString(),"S+":d.getSeconds().toString()};for(let k in b)a=new RegExp("("+k+")").exec(o),a&&(o=o.replace(a[1],a[1].length==1?b[k]:b[k].padStart(a[1].length,"0")));return o},beforeDelete:U,conservation:H,getTypeCodeData:E,getAlterReasonQuery:M}}},p=_=>(le("data-v-bc0183aa"),_=_(),ne(),_),ve={class:"container"},fe={class:"header"},he={class:"content"},ge=p(()=>t("span",{style:{"font-weight":"bold"}},"编号：",-1)),ye=p(()=>t("span",{style:{"font-weight":"bold"}},"重量：",-1)),be=p(()=>t("span",{style:{"font-weight":"bold"}},"标准：",-1)),ke=p(()=>t("span",{style:{"font-weight":"bold"}},"计量员：",-1)),we=p(()=>t("span",{style:{"font-weight":"bold"}},"扫描人：",-1)),Ce=p(()=>t("span",{style:{"font-weight":"bold"}},"生产日期：",-1)),Ie=p(()=>t("span",{style:{color:"red"}},"*",-1)),De=p(()=>t("span",{style:{color:"red"}},"*",-1)),xe={class:"van-uploader"},Se={class:"van-uploader__wrapper"},Re={class:"van-image van-uploader__preview-image"},Je=["src"],Le=["onClick"],je=p(()=>t("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),Fe=[je],Ne=p(()=>t("i",{class:"van-badge__wrapper van-icon van-icon-photograph van-uploader__upload-icon"},null,-1)),Ue=[Ne],Ve={key:0},Be=p(()=>t("span",{style:{color:"red"}},"*",-1));function Pe(_,n,f,e,h,I){const D=Q,m=$,g=ee,x=te,y=ie,L=re,N=ae,j=oe,u=se,S=X,J=K;return w(),R("div",ve,[t("div",fe,[r(D,{title:"品级质检",class:"page-nav-bar","left-arrow":"",onClickLeft:e.onClickLeft},null,8,["onClickLeft"])]),t("div",he,[r(u,{class:"box-card",shadow:"always"},{default:c(()=>[r(m,{"content-position":"left"},{default:c(()=>[C("基本信息")]),_:1}),t("div",null,[t("p",null,[ge,t("span",null,v(e.listData.yjtJyInformationData.batchnumber),1)]),t("p",null,[ye,t("span",null,v(parseFloat(e.listData.yjtJyInformationData.suttle))+v(e.listData.yjtJyInformationData.unit),1)]),t("p",null,[be,t("span",null,v(e.listData.yjtJyInformationData.standard),1)]),t("p",null,[ke,t("span",null,v(e.listData.yjtJyInformationData.suttleperson),1),C("      "),we,t("span",null,v(e.listData.yjtJyInformationData.scanUser),1)]),t("p",null,[Ce,t("span",null,v(e.dateFormat("YYYY-mm-dd HH:MM:SS",e.listData.yjtJyInformationData.proDate)),1)])]),t("div",null,[r(m,{"content-position":"left"},{default:c(()=>[Ie,C(v(e.typeCodeText),1)]),_:1}),r(x,{modelValue:e.typeCodeChecked,"onUpdate:modelValue":n[0]||(n[0]=l=>e.typeCodeChecked=l),direction:"horizontal"},{default:c(()=>[(w(!0),R(B,null,P(e.listData.typeCodeList,(l,U)=>(w(),O(g,{name:String(l.id)},{default:c(()=>[C(v(l.name),1)]),_:2},1032,["name"]))),256))]),_:1},8,["modelValue"])]),t("div",null,[r(m,{"content-position":"left"},{default:c(()=>[De,C(" 质检照片")]),_:1}),t("div",xe,[t("div",Se,[(w(!0),R(B,null,P(e.fileList,(l,U)=>(w(),R("div",{class:"van-uploader__preview",key:l.index},[t("div",Re,[t("img",{class:"van-image__img",src:l.base64Img,style:{"object-fit":"cover"},onClick:n[1]||(n[1]=(...F)=>e.seeImg&&e.seeImg(...F))},null,8,Je)]),t("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:F=>e.beforeDelete(l.index,l.base64Img)},Fe,8,Le)]))),128)),t("div",{class:"van-uploader__upload",onClick:n[2]||(n[2]=(...l)=>e.takePhotoZJ&&e.takePhotoZJ(...l))},Ue)])])]),e.tabIndex==1?(w(),R("div",Ve,[r(m,{"content-position":"left"},{default:c(()=>[Be,C("改判理由")]),_:1}),r(L,{modelValue:e.alterReason,"onUpdate:modelValue":n[3]||(n[3]=l=>e.alterReason=l),filterable:"",clearable:"","allow-create":"",placeholder:"改判理由",style:{width:"100%"}},{default:c(()=>[(w(!0),R(B,null,P(e.listData.alterReasonList,l=>(w(),O(y,{key:l.alterReason,label:l.alterReason,value:l.alterReason},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):W("",!0),t("div",null,[r(m,{"content-position":"left"},{default:c(()=>[C("备注")]),_:1}),r(j,{inset:""},{default:c(()=>[r(N,{modelValue:e.remarks,"onUpdate:modelValue":n[4]||(n[4]=l=>e.remarks=l),rows:"1",autosize:"",label:"备注",type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})])]),_:1}),r(S,{type:"primary",size:"large",style:{width:"80%",position:"absolute",left:"10%","margin-top":"15px","background-color":"#003363",color:"#FFFFFF"},onClick:e.conservation},{default:c(()=>[C("提交 ")]),_:1},8,["onClick"]),r(J,{show:e.showImage,"onUpdate:show":n[5]||(n[5]=l=>e.showImage=l),images:e.imgList,closeable:!0,loop:!1,closeOnPopstate:!0},null,8,["show","images"])])])}const Qe=T(me,[["render",Pe],["__scopeId","data-v-bc0183aa"]]);export{Qe as default};
