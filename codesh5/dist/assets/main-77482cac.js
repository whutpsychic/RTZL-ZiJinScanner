import{E as I,a as q}from"./el-table-column-fc3b1b53.js";import{_ as B,a as j,k as x,r as g,u as R,m as S,e as h,s as N,o as E,c as P,b as u,d as l,w,q as T,g as U,N as H,v as V,t as F,p as W,i as M}from"./index-19a85e56.js";import{b as z,d as A,s as G}from"./chukudan-f943609a.js";import{_ as J}from"./btn_queren-a649dfc1.js";import{_ as K}from"./btn_shoudong-49ae805b.js";import{_ as O}from"./btn_tichu-bca5bbb8.js";import"./request-10ed19d1.js";const Q={setup(){const p=j(),_=x();let n=g([]),o=g([{yingjian:0,yijian:0,queshao:0},{yingjian:"",yijian:0,queshao:""}]);const y=()=>history.back(),c=R();let f=0,s=0;const v=()=>{p.push({name:"manualUnqualifiedBarcodes"})};let i="";const C=(t,e,a)=>{i=T(t)},L=()=>{if(i){let t=n.value.filter(e=>e.barcode!=i.barcode);n.value=t,c.commit("setScandList",n.value),i="",k(t)}else h("请选择要剔除的行！")},D=()=>{c.state.chukudan;let t=c.state.chukudanListInfo,e=c.state.carInfo;c.state.userInfo;let a={};a.carNo=e.plateNo,a.carUnit=e.forwardingUnit,a.deliveryNo=e.deliveryNo,a.materialCode=t.materialCode,a.materialId=t.materialDescribeId,a.materialName=t.materialDescribe,a.pickPackage=f,a.pickWeight=s,a.receiveUnit=t.receiveUnit,a.remark=t.remark,a.sendPlanNo=t.billNo,a.type=t.type,a.unit=t.unit,a.warehouseCode=e.warehouseCode,a.warehouseName=e.warehouseName;let r=[];n.value.forEach(d=>{let m={};m.barcode=d.barcode,m.batchNo=d.batchNo,m.blocks=d.blocks,m.carNo=e.plateNo,m.code=d.code,m.unit=d.unit,m.weight=d.weight,r.push(m)}),N(),G({pickBill:a,pickBillDetailList:r}).then(d=>{(d.data.state=!0)?(n.value=[],c.commit("setScandList",n.value),U({message:"拣配成功!",type:"success",className:"toast",overlay:!0})):h(d.data.message)})},k=t=>{let e=c.state.chukudanListInfo;o.value[0].yingjian=e.planNum,o.value[0].queshao=e.planNum,f=0,s=0,t.forEach(a=>{f+=a.blocks,s+=a.weight}),o.value[0].yijian=s,o.value[1].yijian=f,s>0&&(o.value[0].queshao=(o.value[0].yingjian-s/1e3).toFixed(4)),o.value[0].queshao<0&&h("请求数量过多！")};return S(()=>{let t=_.query,e=c.state.scandList||[];if(n.value=e,k(e),t.barcode){if(!z(t.barcode.trim())){h("条形码不符合规范");return}for(let r=0;r<e.length;r++)if(e[r].barcode==t.barcode){h("该批次已经选择，请勿重复选择！");return}N("加载中"),A(t.barcode).then(r=>{r.data.value===!0?h(r.data.message):(e.push(r.data.value),c.commit("setScandList",e),n.value=e,k(e))})}}),{onClickLeft:y,tableData1:n,tableData2:o,onHandle:v,onConfirm:D,selectRow:C,onDelete:L}}},b=p=>(W("data-v-ec1cf12f"),p=p(),M(),p),X={class:"container"},Y={class:"btn-area"},Z=b(()=>l("img",{src:J,alt:""},null,-1)),$=b(()=>l("div",null,"确认",-1)),ee=[Z,$],ae=b(()=>l("img",{src:K,alt:"",type:"primary"},null,-1)),te=b(()=>l("div",null,"手动",-1)),oe=[ae,te],se=b(()=>l("img",{src:O,alt:"",type:"primary"},null,-1)),ie=b(()=>l("div",null,"剔除",-1)),le=[se,ie];function ne(p,_,n,o,y,c){const f=H,s=q,v=I;return E(),P("main",null,[u(f,{title:"拣配",class:"page-nav-bar","left-arrow":"",onClickLeft:o.onClickLeft},null,8,["onClickLeft"]),l("div",X,[u(v,{data:o.tableData1,border:"",id:"data-area1",onRowClick:o.selectRow},{default:w(()=>[u(s,{label:"日期",width:"150px"},{default:w(i=>[V(F(i.row.proDate.substr(0,10)),1)]),_:1}),u(s,{prop:"code",label:"一维码",width:"210px"}),u(s,{prop:"weight",label:"重量",width:"110px"})]),_:1},8,["data","onRowClick"]),u(v,{data:o.tableData2,border:"",id:"data-area2"},{default:w(()=>[u(s,{prop:"yingjian",label:"应拣"}),u(s,{prop:"yijian",label:"已拣"}),u(s,{prop:"queshao",label:"缺少"})]),_:1},8,["data"]),l("div",Y,[l("div",{onClick:_[0]||(_[0]=(...i)=>o.onConfirm&&o.onConfirm(...i))},ee),l("div",{onClick:_[1]||(_[1]=(...i)=>o.onHandle&&o.onHandle(...i))},oe),l("div",{onClick:_[2]||(_[2]=(...i)=>o.onDelete&&o.onDelete(...i))},le)])])])}const fe=B(Q,[["render",ne],["__scopeId","data-v-ec1cf12f"]]);export{fe as default};
