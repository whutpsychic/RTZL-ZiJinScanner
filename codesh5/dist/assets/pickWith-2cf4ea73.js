import"./el-tag-f8ec1a70.js";import{E as ce}from"./el-overlay-1f30441e.js";import{_ as de,u as re,H as ue,r as m,a as pe,I as he,f as G,t as w,g1 as me,o as _e,c as A,d as Y,e as l,w as g,k as o,g as J,l as R,F as Z,J as fe,P as ge,Q as $,N as we,W as Q,O as ve,p as be,j as ye,X as ke,a2 as Fe,a3 as Ce,Z as xe,a1 as Be,S as ze,a4 as Te}from"./index-ecb86d45.js";/* empty css              */import{E as De,a as He}from"./el-select-b7f3ea5a.js";import"./el-popper-81f3a1c7.js";import{E as Ee,a as Re}from"./el-table-column-7d33d5e6.js";/* empty css              */import{B as F}from"./bignumber-266e6c56.js";import{c as ee,b as Le,s as Se}from"./pickWith-4f8088ee.js";import{_ as Ie,a as Ne}from"./btn_shoudong-07961c15.js";import{_ as je}from"./btn_tichu-bca5bbb8.js";import{s as M,a as _}from"./function-call-509584aa.js";import"./index-95c1965a.js";import"./use-global-config-a7f40fa2.js";import"./objects-aa909a4b.js";import"./index-dd289210.js";const Ue={setup(){const v=re();ue();const n=m([]),y=pe(),t=m(""),U=m(""),b=m("0"),D=m(""),H=m("0"),z=m("0"),L=m("0"),T=m(!1),E=m(""),C=m(""),q=m(""),P=m(""),x=he({barCodeSelectList:[]});G.await("scanner",e=>{if(v.currentRoute.value.path=="/pickWith")if(e!="null"){let a=e;if(new RegExp(/^124010[1-9][0-9]{2}(0[1-9]|1[0-2])((0[1-9])|((1|2)[0-9])|30|31)[0-9]{12}$/).test(a)&&a.length===25){let c={};c.fBarcode=a,ee(c).then(s=>{if(s.data.data)return I(a).then(u=>{let p=u.shengchanriqi,h=u.kunxuhao,k=u.barcode,B=u.kunjingzhong,j={date:p,number:h,barcode:k,weight:B};N(w(n.value),j)});{let u="",p=!0;s.data.distinguish=="1"?u='<span style="font-size: 18px;color: red">'+s.data.message+"</span>":s.data.distinguish=="2"?u='<span style="font-size: 18px;color: #0e80d2">'+s.data.message+"</span>":s.data.distinguish=="4"?(p=!1,M({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">'+s.data.message+"</span>"}).then(()=>I(a).then(h=>{let k=h.shengchanriqi,B=h.kunxuhao,j=h.barcode,X=h.kunjingzhong,ie={date:k,number:B,barcode:j,weight:X};N(w(n.value),ie)})).catch(h=>{console.log(h)})):u='<span style="font-size: 18px">'+s.data.message+"</span>",p&&_({title:"提示",width:"600",allowHtml:!0,message:u}).then(()=>{})}})}else _({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">对不起，此条码不符合规范</span>'}).then(()=>{})}else _({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">数据获取失败</span>'}).then(()=>{})}),window.history.pushState(null,null,document.URL),window.addEventListener("popstate",V,!1),me(()=>{window.removeEventListener("popstate",V,!1)});function V(){v.push({path:"/pickWithQueryInfoData"})}const O=()=>{v.push({path:"/pickWithQueryInfoData"})},W=()=>{T.value=!1},i=()=>{T.value=!0};let S="";const te=(e,a,d)=>{S=w(e)},ae=()=>{G.scan()};_e(()=>{G.register("goback",()=>{v.push({path:"/pickWithQueryInfoData"})});let e=w(y.state.chukudanListInfo);w(y.state.carInfo.pizhong)&&(H.value=w(y.state.carInfo.pizhong).toFixed(4)),U.value=new F(e.F_PLANSUTTLE).minus(e.F_SUTTLE).toFixed(4),D.value=new F(e.F_PLANSUTTLE).minus(e.F_SUTTLE).toFixed(4),L.value=new F(H.value).plus(b.value).toFixed(4)});const oe=()=>{if(C.value=="")return _({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">请选择条形码</span>'}).then(()=>{}),!1;T.value=!1;let e=C.value;if(new RegExp(/^124010[1-9][0-9]{2}(0[1-9]|1[0-2])((0[1-9])|((1|2)[0-9])|30|31)[0-9]{12}$/).test(e)&&e.length===25){let r={};r.fBarcode=e,ee(r).then(c=>{if(c.data.data)return I(e).then(s=>{let u=s.shengchanriqi,p=s.kunxuhao,h=s.barcode,k=s.kunjingzhong,B={date:u,number:p,barcode:h,weight:k};N(w(n.value),B)});{let s="",u=!0;c.data.distinguish=="1"?s='<span style="font-size: 18px;color: red">'+c.data.message+"</span>":c.data.distinguish=="2"?s='<span style="font-size: 18px;color: #0e80d2">'+c.data.message+"</span>":c.data.distinguish=="4"?(u=!1,M({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">'+c.data.message+"</span>"}).then(()=>I(e).then(p=>{let h=p.shengchanriqi,k=p.kunxuhao,B=p.barcode,j=p.kunjingzhong,X={date:h,number:k,barcode:B,weight:j};N(w(n.value),X)})).catch(p=>{console.log(p)})):s='<span style="font-size: 18px">'+c.data.message+"</span>",u&&_({title:"提示",width:"600",allowHtml:!0,message:s}).then(()=>{})}})}else _({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">对不起，此条码不符合规范</span>'}).then(()=>{})},ne=e=>{C.value="";let d={strBatchno:e.F_BATCHNUMBER+"-"+e.F_BATCHGROUP};Le(d).then(r=>{x.barCodeSelectList=r.data.data,x.barCodeSelectList.length>0?fe({message:"数据查询成功",type:"success",className:"particulars-detail-popup",overlay:!0}):_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">没有查询到对应的条码数据</span>'}).then(()=>{})}).catch(r=>{console.log(r)})},se=()=>{S?M({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">是否要剔除当前所选数据？</span>'}).then(()=>{let e=n.value.filter(a=>a.barcode!=S.barcode);n.value=e,E.value="edit",K(e,S),S=""}).catch(e=>{console.log(e)}):_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">请选择要剔除的的数据</span>'}).then(()=>{})},le=()=>{if(n.value.length==0)return _({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">没有要处理的数据</span>'}).then(()=>{}),!1;M({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">是否已完成扫描？</span>'}).then(()=>{ge({duration:0,forbidClick:!0,overlay:!0,className:"particulars-detail-popup",message:"拣配中..."});let e=w(y.state.chukudanListInfo),a=w(y.state.carInfo),d={};d.F_DELIVERYNO=e.F_DELIVERYNO,d.strSuttle=b.value,d.strTruckNo=a.chehao,d.weighthousename=a.chengfang,d.id=a.danjuhao,a.DataId?d.strDataId=a.DataId:d.strDataId="";let r=w(n.value).map(c=>c.barcode+",").join("");d.strBarcodes=r.substring(0,r.length-1),Se(d).then(c=>{$(),c.data.code=="200"?(n.value=[],_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">'+c.data.message+"</span>"}).then(()=>{y.commit("setPickWithScroll",0),y.commit("setChukudanListInfo",{}),y.commit("setCarInfo",{}),v.push({path:"/pickWithQueryListData"})})):_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">'+c.data.message+"</span>"}).then(()=>{})})}).catch(e=>{console.log(e),$()})},K=(e,a)=>{E.value=="add"?b.value=new F(b.value).plus(new F(a.weight).dividedBy(1e3).toNumber()).toFixed(4):b.value=new F(b.value).minus(new F(a.weight).dividedBy(1e3).toNumber()).toFixed(4),D.value=new F(U.value).minus(b.value).toFixed(4),L.value=new F(H.value).plus(b.value).toFixed(4),z.value=e.length,n.value=e,t.value=Math.random(),D.value<0&&_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">缺少数值已为负数</span>'}).then(()=>{})},I=e=>{let a=e.split("");const d=a.slice(0,3).join(""),r=a.slice(3,5).join(""),c=a.slice(5,7).join(""),s=a.slice(7,13).join(""),u=a.slice(13,17).join(""),p=a.slice(17,20).join(""),h=a.slice(20,24).join("")+"."+a[24];return new Promise((k,B)=>{k({barcode:e,qiyedaima:d,chanpinleibie:r,chanpindengji:c,shengchanriqi:s,chanpinpihao:u,kunxuhao:p,kunjingzhong:h})})},N=(e,a)=>{if(e.find(r=>r.barcode===a.barcode))_({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">该批次已经选择，请勿重复选择</span>'}).then(()=>{});else{let r=[];e.unshift(a),r=e,E.value="add",K(r,a)}};return{typeName:E,barCodeSelect:C,F_BATCHGROUP:q,F_BATCHNUMBER:P,listData:x,itemKey:t,yingj:U,yij1:b,ques:D,pizhong:H,yij2:z,pz:L,tableData:n,centerDialogVisibleTXM:T,passedTXMClick:oe,onSubmit:ne,closeTXMClick:W,checkIfExist:N,decode:I,scanCode:ae,onClickLeft:O,onHandle:i,onConfirm:le,selectRow:te,onDelete:se}}},f=v=>(be("data-v-41d9f539"),v=v(),ye(),v),Ve={class:"container"},Ae={class:"info-container"},Me=f(()=>o("span",{class:"title"},"应拣",-1)),qe=f(()=>o("span",{class:"title"},"已拣",-1)),Pe=f(()=>o("span",{class:"title"},"缺少",-1)),Oe=f(()=>o("span",{class:"title"},"皮重",-1)),We=f(()=>o("span",{class:"title"},"捆数",-1)),Xe=f(()=>o("span",{class:"title"},"合计",-1)),Ge={class:"btn-area"},Qe=f(()=>o("img",{src:Ie},null,-1)),Ke=f(()=>o("div",null,"确认",-1)),Ye=[Qe,Ke],Je=f(()=>o("img",{src:Ne},null,-1)),Ze=f(()=>o("div",null,"手动",-1)),$e=[Je,Ze],et=f(()=>o("img",{src:je},null,-1)),tt=f(()=>o("div",null,"剔除",-1)),at=[et,tt],ot={style:{margin:"16px"}},nt={style:{"margin-top":"10px"}},st=f(()=>o("p",null,"条形码",-1));function lt(v,n,y,t,U,b){const D=ke,H=we,z=Re,L=Ee,T=Fe,E=Ce,C=xe,q=De,P=He,x=Be,V=ze,O=Te,W=ce;return A(),Y(Z,null,[l(H,{title:"拣配",class:"page-nav-bar","left-arrow":"",onClickLeft:t.onClickLeft},{right:g(()=>[l(D,{onClick:t.scanCode,style:{color:"#FFFFFF"},name:"scan",size:"40"},null,8,["onClick"])]),_:1},8,["onClickLeft"]),o("div",Ve,[(A(),J(L,{data:t.tableData,style:{height:"260px"},id:"data-area1",key:t.itemKey,"highlight-current-row":"",onRowClick:t.selectRow},{default:g(()=>[l(z,{fixed:"",prop:"date",label:"日期"}),l(z,{prop:"number",label:"包号"}),l(z,{prop:"weight",label:"重量"}),l(z,{prop:"barcode",label:"条码",width:"250"})]),_:1},8,["data","onRowClick"])),o("div",Ae,[Me,qe,Pe,o("span",null,R(t.yingj),1),o("span",null,R(t.yij1),1),o("span",null,R(t.ques),1),Oe,We,Xe,o("span",null,R(t.pizhong),1),o("span",null,R(t.yij2),1),o("span",null,R(t.pz),1)]),o("div",Ge,[o("div",{onClick:n[0]||(n[0]=(...i)=>t.onConfirm&&t.onConfirm(...i))},Ye),o("div",{onClick:n[1]||(n[1]=(...i)=>t.onHandle&&t.onHandle(...i))},$e),o("div",{onClick:n[2]||(n[2]=(...i)=>t.onDelete&&t.onDelete(...i))},at)])]),l(W,{modelValue:t.centerDialogVisibleTXM,"onUpdate:modelValue":n[6]||(n[6]=i=>t.centerDialogVisibleTXM=i),title:"手动不合格条码",width:"96%","align-center":""},{default:g(()=>[l(O,{onSubmit:t.onSubmit},{default:g(()=>[l(E,{inset:""},{default:g(()=>[l(T,{modelValue:t.F_BATCHGROUP,"onUpdate:modelValue":n[3]||(n[3]=i=>t.F_BATCHGROUP=i),name:"F_BATCHGROUP",label:"批次号",placeholder:"批次号(四位)",rules:[{required:!0,message:"请填写批次号"}]},null,8,["modelValue"]),l(T,{modelValue:t.F_BATCHNUMBER,"onUpdate:modelValue":n[4]||(n[4]=i=>t.F_BATCHNUMBER=i),name:"F_BATCHNUMBER",label:"编号",placeholder:"编号(三位)",rules:[{required:!0,message:"请填写编号"}]},null,8,["modelValue"])]),_:1}),o("div",ot,[l(C,{square:"",icon:"search",block:"",type:"primary","native-type":"submit",style:{"background-color":"#003363",color:"#FFFFFF"}},{default:g(()=>[Q(" 查询 ")]),_:1}),o("div",nt,[st,l(P,{modelValue:t.barCodeSelect,"onUpdate:modelValue":n[5]||(n[5]=i=>t.barCodeSelect=i),placeholder:"条形码",style:{width:"100%"}},{default:g(()=>[(A(!0),Y(Z,null,ve(t.listData.barCodeSelectList,i=>(A(),J(q,{key:i.F_BARCODE,label:i.F_BARCODE,value:i.F_BARCODE},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),l(V,{style:{"margin-top":"15px"}},{default:g(()=>[l(x,{span:"2"}),l(x,{span:"10"},{default:g(()=>[l(C,{icon:"passed",style:{"background-color":"#003363",color:"#FFFFFF"},onClick:t.passedTXMClick},{default:g(()=>[Q("确定 ")]),_:1},8,["onClick"])]),_:1}),l(x,{span:"10",style:{"text-align":"center"}},{default:g(()=>[l(C,{icon:"close",style:{"background-color":"red",color:"#FFFFFF"},onClick:t.closeTXMClick},{default:g(()=>[Q("退出 ")]),_:1},8,["onClick"])]),_:1}),l(x,{span:"2"})]),_:1})])]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"])],64)}const Ct=de(Ue,[["render",lt],["__scopeId","data-v-41d9f539"]]);export{Ct as default};
