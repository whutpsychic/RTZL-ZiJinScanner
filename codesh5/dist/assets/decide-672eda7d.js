import{_ as z,u as A,E as Q,r as i,H as G,I as O,o as W,b as C,c as S,i as t,d as r,w as c,J as U,P as K,Q as T,N as X,Z as $,V as ee,W as I,j as v,F as B,O as P,e as Y,f as te,$ as ae,a5 as oe,a6 as le,a2 as ne,a3 as se,p as ie,h as re}from"./index-b858ed87.js";import{E as de}from"./el-card-205f10c4.js";/* empty css              */import"./el-tag-9e3a0ffc.js";import{E as ce,a as pe}from"./el-select-91c057c6.js";import"./el-popper-b0a8955c.js";/* empty css              *//* empty css              */import{d as ue,g as _e,b as me,e as ve}from"./gradeDetermination-3fe0487a.js";import"./index-247f35ee.js";function fe(_){let n=_.split(","),f=n[0].match(/:(.*?);/)[1],e=atob(n[1]),h=e.length,D=new Uint8Array(h);for(;h--;)D[h]=e.charCodeAt(h);let x=Math.random().toString(36).slice(-8),m=f.split("/")[1];return new File([D],x+"."+m,{type:f})}const he={setup(){const _=A(),n=Q(),f=i(""),e=i(""),h=i(""),D=i(""),x=i(""),m=i(""),g=i([]),L=i([]),y=i([]),J=i(!1),N=i(!1),j=i([]),u=G({yjtJyInformationData:{},typeCodeList:[],alterReasonList:[]}),b=i(!1);u.yjtJyInformationData=JSON.parse(decodeURIComponent(n.query.yjtJyInformation));const R=i(JSON.parse(decodeURIComponent(n.query.exterior))),l=i(JSON.parse(decodeURIComponent(n.query.tabIndex)));O.await("takePhoto",o=>{if(o!="null"){let s={};s.index=g.value.length+1,s.base64Img=o,g.value.push(s),L.value.push(o);let a=new FormData,d="/cathodeCopper/"+u.yjtJyInformationData.batchgroup+"/"+u.yjtJyInformationData.batchnumber;a.append("file",fe(o)),a.append("path",d),ue(a).then(k=>{let w={};w.fileName=k.data.fileName,w.fileUrl=k.data.fileUrl,w.index=g.value.length,y.value.push(w)}).catch(k=>{console.log(k)})}});const V=()=>{O.takePhoto()},F=(o,s)=>{y.value=y.value.filter(a=>a.index!=o),g.value=g.value.filter(a=>a.index!=o),L.value=L.value.filter(a=>a!=s)},q=()=>{j.value=L.value,J.value=!0};R.value=="1"?(f.value="qualified",e.value="合格品类型"):R.value=="2"&&(f.value="unqualified",e.value="不合格品类型"),W(()=>{E(f.value),M()});const H=()=>{_.back()},Z=()=>{if(b.value=!0,y.value.length==0)return U({message:"请上传质检照片",type:"fail",className:"particulars-detail-popup"}),b.value=!1,!1;if(l.value==1&&!D.value)return U({message:"请选择或者填写改判理由",type:"fail",className:"particulars-detail-popup"}),b.value=!1,!1;K({duration:0,forbidClick:!0,className:"particulars-detail-popup",message:"正在质检..."});let o={data:[],active:"",exterior:"",remarks:"",alterReason:"",typeCodeChecked:"",fileList:[],labelFileList:[]},s=[];s.push(u.yjtJyInformationData),o.data=s,o.typeCodeChecked=x.value,o.active=l.value,o.exterior=R.value,o.remarks=h.value,o.alterReason=D.value,o.fileList=y.value,ve(o).then(a=>{T(),a.data.code==200&&(U({message:"质检成功",type:"success",className:"particulars-detail-popup",overlay:!0}),b.value=!1,_.back())}).catch(a=>{console.log(a),b.value=!1,T()})},E=o=>{let s={};s.typeCode=o,_e(s).then(a=>{a.data.code==200&&(u.typeCodeList=a.data.data,x.value=String(u.typeCodeList[0].id))}).catch(a=>{console.log(a)})},M=()=>{let o={},s={},a={};a.limit=9999,a.offset=1,a.blockId="paramBlock",a.data={},s.paramBlock=a,o.blocks=s,me(o).then(d=>{u.alterReasonList=d.data.blocks.resultBlock.data}).catch(d=>{console.log(d)})};return{imgList:j,showImage:J,showLabelImage:N,fileList:g,base64ImgList:L,imagePath:y,takePhotoState:m,alterReason:D,remarks:h,typeCode:f,typeCodeText:e,listData:u,exterior:R,tabIndex:l,typeCodeChecked:x,disabled:b,seeImg:q,takePhotoZJ:V,onClickLeft:H,dateFormat:(o,s)=>{let a,d=new Date(s);const k={"Y+":d.getFullYear().toString(),"m+":(d.getMonth()+1).toString(),"d+":d.getDate().toString(),"H+":d.getHours().toString(),"M+":d.getMinutes().toString(),"S+":d.getSeconds().toString()};for(let w in k)a=new RegExp("("+w+")").exec(o),a&&(o=o.replace(a[1],a[1].length==1?k[w]:k[w].padStart(a[1].length,"0")));return o},beforeDelete:F,conservation:Z,getTypeCodeData:E,getAlterReasonQuery:M}}},p=_=>(ie("data-v-c5b26c0f"),_=_(),re(),_),ge={class:"container"},ye={class:"header"},be={class:"content"},ke=p(()=>t("span",{style:{"font-weight":"bold"}},"编号：",-1)),we=p(()=>t("span",{style:{"font-weight":"bold"}},"重量：",-1)),Ce=p(()=>t("span",{style:{"font-weight":"bold"}},"标准：",-1)),Ie=p(()=>t("span",{style:{"font-weight":"bold"}},"计量员：",-1)),De=p(()=>t("span",{style:{"font-weight":"bold"}},"扫描人：",-1)),xe=p(()=>t("span",{style:{"font-weight":"bold"}},"生产日期：",-1)),Le=p(()=>t("span",{style:{color:"red"}},"*",-1)),Re=p(()=>t("span",{style:{color:"red"}},"*",-1)),Se={class:"van-uploader"},Je={class:"van-uploader__wrapper"},je={class:"van-image van-uploader__preview-image"},Fe=["src"],Ne=["onClick"],Ve=p(()=>t("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),Ue=[Ve],Be=p(()=>t("i",{class:"van-badge__wrapper van-icon van-icon-photograph van-uploader__upload-icon"},null,-1)),Pe=[Be],Ee={key:0},Me=p(()=>t("span",{style:{color:"red"}},"*",-1));function Oe(_,n,f,e,h,D){const x=X,m=ae,g=oe,L=le,y=ce,J=pe,N=ne,j=se,u=de,b=$,R=ee;return C(),S("div",ge,[t("div",ye,[r(x,{title:"品级质检",class:"page-nav-bar","left-arrow":"",onClickLeft:e.onClickLeft},null,8,["onClickLeft"])]),t("div",be,[r(u,{class:"box-card",shadow:"always"},{default:c(()=>[r(m,{"content-position":"left"},{default:c(()=>[I("基本信息")]),_:1}),t("div",null,[t("p",null,[ke,t("span",null,v(e.listData.yjtJyInformationData.batchnumber),1)]),t("p",null,[we,t("span",null,v(parseFloat(e.listData.yjtJyInformationData.suttle))+v(e.listData.yjtJyInformationData.unit),1)]),t("p",null,[Ce,t("span",null,v(e.listData.yjtJyInformationData.standard),1)]),t("p",null,[Ie,t("span",null,v(e.listData.yjtJyInformationData.suttleperson),1),I("      "),De,t("span",null,v(e.listData.yjtJyInformationData.scanUser),1)]),t("p",null,[xe,t("span",null,v(e.dateFormat("YYYY-mm-dd HH:MM:SS",e.listData.yjtJyInformationData.proDate)),1)])]),t("div",null,[r(m,{"content-position":"left"},{default:c(()=>[Le,I(v(e.typeCodeText),1)]),_:1}),r(L,{modelValue:e.typeCodeChecked,"onUpdate:modelValue":n[0]||(n[0]=l=>e.typeCodeChecked=l),direction:"horizontal"},{default:c(()=>[(C(!0),S(B,null,P(e.listData.typeCodeList,(l,V)=>(C(),Y(g,{name:String(l.id)},{default:c(()=>[I(v(l.name),1)]),_:2},1032,["name"]))),256))]),_:1},8,["modelValue"])]),t("div",null,[r(m,{"content-position":"left"},{default:c(()=>[Re,I(" 质检照片")]),_:1}),t("div",Se,[t("div",Je,[(C(!0),S(B,null,P(e.fileList,(l,V)=>(C(),S("div",{class:"van-uploader__preview",key:l.index},[t("div",je,[t("img",{class:"van-image__img",src:l.base64Img,style:{"object-fit":"cover"},onClick:n[1]||(n[1]=(...F)=>e.seeImg&&e.seeImg(...F))},null,8,Fe)]),t("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:F=>e.beforeDelete(l.index,l.base64Img)},Ue,8,Ne)]))),128)),t("div",{class:"van-uploader__upload",onClick:n[2]||(n[2]=(...l)=>e.takePhotoZJ&&e.takePhotoZJ(...l))},Pe)])])]),e.tabIndex==1?(C(),S("div",Ee,[r(m,{"content-position":"left"},{default:c(()=>[Me,I("改判理由")]),_:1}),r(J,{modelValue:e.alterReason,"onUpdate:modelValue":n[3]||(n[3]=l=>e.alterReason=l),filterable:"",clearable:"","allow-create":"",placeholder:"改判理由",style:{width:"100%"}},{default:c(()=>[(C(!0),S(B,null,P(e.listData.alterReasonList,l=>(C(),Y(y,{key:l.alterReason,label:l.alterReason,value:l.alterReason},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):te("",!0),t("div",null,[r(m,{"content-position":"left"},{default:c(()=>[I("备注")]),_:1}),r(j,{inset:""},{default:c(()=>[r(N,{modelValue:e.remarks,"onUpdate:modelValue":n[4]||(n[4]=l=>e.remarks=l),rows:"1",autosize:"",label:"备注",type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})])]),_:1}),r(b,{type:"primary",size:"large",disabled:e.disabled,style:{width:"80%",position:"absolute",left:"10%","margin-top":"15px","background-color":"#003363",color:"#FFFFFF"},onClick:e.conservation},{default:c(()=>[I("提交 ")]),_:1},8,["disabled","onClick"]),r(R,{show:e.showImage,"onUpdate:show":n[5]||(n[5]=l=>e.showImage=l),images:e.imgList,closeable:!0,loop:!1,closeOnPopstate:!0},null,8,["show","images"])])])}const Xe=z(he,[["render",Oe],["__scopeId","data-v-c5b26c0f"]]);export{Xe as default};
