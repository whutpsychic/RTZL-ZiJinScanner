import{_ as B,u as z,I as M,r as R,J as E,o as P,b as F,c as j,j as n,d as _,w as h,s as J,N as A,V as Y,S as b,k as C,F as N,M as V,e as U,g as q,W as T,Z as O,$ as G,a0 as K,a1 as Q,a2 as Z,p as X,i as H}from"./index-1104ee59.js";import"./index-8067bac9.js";import{E as W}from"./el-card-4fbdce5d.js";import{E as $,a as ee}from"./el-select-60759d66.js";import"./el-popper-8208629c.js";/* empty css              *//* empty css              */import{t as te,b as ae,e as oe,d as ne}from"./gradeDetermination-c6c56c5b.js";function le(l,r){var g=.52;return parseInt((l.size/1024).toFixed(2))<1024&&(g=.85),5*1024<parseInt((l.size/1024).toFixed(2))&&(g=.92),r&&(g=r),l[0]?Promise.all(Array.from(l).map(t=>this.compressImg(t,g))):new Promise(t=>{if((l.size/1024).toFixed(2)<300)t({file:l});else{const S=new FileReader;S.onload=({target:{result:k}})=>{const p=new Image;p.onload=async()=>{const o=document.createElement("canvas"),v=o.getContext("2d");var i=p.width,u=p.height,d=p.width,c=p.height;if(1*1024<=parseInt((l.size/1024).toFixed(2))&&parseInt((l.size/1024).toFixed(2))<=10*1024){var f=1600,m=1600;i=d,u=c,(d>f||c>m)&&(d/c>f/m?(i=f,u=Math.round(f*(c/d))):(u=m,i=Math.round(m*(d/c))))}10*1024<=parseInt((l.size/1024).toFixed(2))&&parseInt((l.size/1024).toFixed(2))<=20*1024&&(f=1400,m=1400,i=d,u=c,(d>f||c>m)&&(d/c>f/m?(i=f,u=Math.round(f*(c/d))):(u=m,i=Math.round(m*(d/c))))),o.width=i,o.height=u,v.clearRect(0,0,i,u),v.drawImage(p,0,0,i,u);const x=o.toDataURL("image/jpeg",g),L=atob(x.split(",")[1]);let e=L.length;const s=new Uint8Array(new ArrayBuffer(e));for(;e--;)s[e]=L.charCodeAt(e);const a=new File([s],l.name,{type:"image/jpeg"});t({file:a,origin:l,beforeSrc:k,afterSrc:x,beforeKB:Number((l.size/1024).toFixed(2)),afterKB:Number((a.size/1024).toFixed(2))})},p.src=k},S.readAsDataURL(l)}})}const se={setup(){const l=z(),r=M(),g=R(""),t=R(""),S=R(""),k=R(""),p=R(""),o=E({yjtJyInformationData:{},typeCodeList:[],fileList:[],imagePath:[],alterReasonList:[]});o.yjtJyInformationData=JSON.parse(decodeURIComponent(r.query.yjtJyInformation));const v=R(JSON.parse(decodeURIComponent(r.query.exterior))),i=R(JSON.parse(decodeURIComponent(r.query.tabIndex)));v.value=="1"?(g.value="qualified",t.value="合格品类型"):v.value=="2"&&(g.value="unqualified",t.value="不合格品类型"),P(()=>{m(g.value),x()});const u=()=>{l.back()},d=e=>(o.imagePath=o.imagePath.filter(s=>s.fileName!=e.file.name),!0),c=()=>{if(o.imagePath.length==0)return J({message:"请上传照片",type:"fail",className:"particulars-detail-popup"}),!1;if(i.value==1&&!k.value)return J({message:"请选择或者填写改判理由",type:"fail",className:"particulars-detail-popup"}),!1;let e={data:[],active:"",exterior:"",remarks:"",alterReason:"",typeCodeChecked:"",fileList:[]},s=[];s.push(o.yjtJyInformationData),e.data=s,e.typeCodeChecked=p.value,e.active=i.value,e.exterior=v.value,e.remarks=S.value,e.alterReason=k.value,e.fileList=o.imagePath,oe(e).then(a=>{a.data.code==200&&(J({message:"质检成功",type:"success",className:"particulars-detail-popup",overlay:!0}),l.back())}).catch(a=>{console.log(a)})},f=e=>{le(e.file,"0.9").then(s=>{let a=new FormData,y="/cathodeCopper/"+o.yjtJyInformationData.batchgroup+"/"+o.yjtJyInformationData.batchnumber;a.append("file",s.file),a.append("path",y);let w={};ne(a).then(I=>{w.fileName=I.data.fileName,w.fileUrl=I.data.fileUrl,o.imagePath.push(w)}).catch(I=>{console.log(I)})})};function m(e){let s={};s.typeCode=e,te(s).then(a=>{a.data.code==200&&(o.typeCodeList=a.data.data,p.value=String(o.typeCodeList[0].id))}).catch(a=>{console.log(a)})}function x(){let e={},s={},a={};a.limit=9999,a.offset=1,a.blockId="paramBlock",a.data={},s.paramBlock=a,e.blocks=s,ae(e).then(y=>{o.alterReasonList=y.data.blocks.resultBlock.data}).catch(y=>{console.log(y)})}return{alterReason:k,remarks:S,typeCode:g,typeCodeText:t,listData:o,exterior:v,tabIndex:i,typeCodeChecked:p,onClickLeft:u,dateFormat:(e,s)=>{let a,y=new Date(s);const w={"Y+":y.getFullYear().toString(),"m+":(y.getMonth()+1).toString(),"d+":y.getDate().toString(),"H+":y.getHours().toString(),"M+":y.getMinutes().toString(),"S+":y.getSeconds().toString()};for(let I in w)a=new RegExp("("+I+")").exec(e),a&&(e=e.replace(a[1],a[1].length==1?w[I]:w[I].padStart(a[1].length,"0")));return e},onRead:f,beforeDelete:d,conservation:c}}},D=l=>(X("data-v-f6d1ac64"),l=l(),H(),l),re={class:"container"},ie={class:"header"},de=D(()=>n("span",{style:{"font-weight":"bold"}},"编号：",-1)),ce=D(()=>n("span",{style:{"font-weight":"bold"}},"重量：",-1)),pe=D(()=>n("span",{style:{"font-weight":"bold"}},"标准：",-1)),ue=D(()=>n("span",{style:{"font-weight":"bold"}},"计量员：",-1)),fe=D(()=>n("span",{style:{"font-weight":"bold"}},"扫描人：",-1)),me=D(()=>n("span",{style:{"font-weight":"bold"}},"生产日期：",-1)),_e=D(()=>n("span",{style:{color:"red"}},"*",-1)),ye=D(()=>n("span",{style:{color:"red"}},"*",-1)),ge={key:0},he=D(()=>n("span",{style:{color:"red"}},"*",-1));function ve(l,r,g,t,S,k){const p=A,o=T,v=O,i=G,u=K,d=$,c=ee,f=Q,m=Z,x=W,L=Y;return F(),j("div",re,[n("div",ie,[_(p,{title:"品级质检",class:"page-nav-bar","left-arrow":"",onClickLeft:t.onClickLeft},null,8,["onClickLeft"])]),_(x,{class:"box-card",shadow:"always",style:{"margin-top":"5px"}},{default:h(()=>[_(o,{"content-position":"left"},{default:h(()=>[b("基本信息")]),_:1}),n("div",null,[n("p",null,[de,n("span",null,C(t.listData.yjtJyInformationData.batchnumber),1)]),n("p",null,[ce,n("span",null,C(parseFloat(t.listData.yjtJyInformationData.suttle))+C(t.listData.yjtJyInformationData.unit),1)]),n("p",null,[pe,n("span",null,C(t.listData.yjtJyInformationData.standard),1)]),n("p",null,[ue,n("span",null,C(t.listData.yjtJyInformationData.suttleperson),1),b("     "),fe,n("span",null,C(t.listData.yjtJyInformationData.scanUser),1)]),n("p",null,[me,b(C(t.dateFormat("YYYY-mm-dd HH:MM:SS",t.listData.yjtJyInformationData.proDate)),1)])]),n("div",null,[_(o,{"content-position":"left"},{default:h(()=>[_e,b(C(t.typeCodeText),1)]),_:1}),_(i,{modelValue:t.typeCodeChecked,"onUpdate:modelValue":r[0]||(r[0]=e=>t.typeCodeChecked=e),direction:"horizontal"},{default:h(()=>[(F(!0),j(N,null,V(t.listData.typeCodeList,(e,s)=>(F(),U(v,{name:String(e.id)},{default:h(()=>[b(C(e.name),1)]),_:2},1032,["name"]))),256))]),_:1},8,["modelValue"])]),n("div",null,[_(o,{"content-position":"left"},{default:h(()=>[ye,b(" 上传照片")]),_:1}),_(u,{modelValue:t.listData.fileList,"onUpdate:modelValue":r[1]||(r[1]=e=>t.listData.fileList=e),"after-read":t.onRead,"before-delete":t.beforeDelete},null,8,["modelValue","after-read","before-delete"])]),t.tabIndex==1?(F(),j("div",ge,[_(o,{"content-position":"left"},{default:h(()=>[he,b("改判理由")]),_:1}),_(c,{modelValue:t.alterReason,"onUpdate:modelValue":r[2]||(r[2]=e=>t.alterReason=e),filterable:"",clearable:"","allow-create":"",placeholder:"改判理由",style:{width:"100%"}},{default:h(()=>[(F(!0),j(N,null,V(t.listData.alterReasonList,e=>(F(),U(d,{key:e.alterReason,label:e.alterReason,value:e.alterReason},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):q("",!0),n("div",null,[_(o,{"content-position":"left"},{default:h(()=>[b("备注")]),_:1}),_(m,{inset:""},{default:h(()=>[_(f,{modelValue:t.remarks,"onUpdate:modelValue":r[3]||(r[3]=e=>t.remarks=e),rows:"1",autosize:"",label:"备注",type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})])]),_:1}),_(L,{type:"primary",size:"large",style:{width:"80%",position:"absolute",left:"10%","margin-top":"15px"},onClick:t.conservation},{default:h(()=>[b("提交 ")]),_:1},8,["onClick"])])}const xe=B(se,[["render",ve],["__scopeId","data-v-f6d1ac64"]]);export{xe as default};
