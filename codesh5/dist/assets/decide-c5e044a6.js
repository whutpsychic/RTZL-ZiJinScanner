import{c as z,d as A,i as E,a3 as X,a as c,n as $,a4 as ee,w as H,a5 as ae,h as te,_ as oe,k as le,Y as ne,p as d,Z as se,s as P,q as re,x as D,y as J,F as a,z as v,a2 as ie,N as x,G as g,H as U,a1 as B,A as T,C as de,D as ce,E as ue}from"./index-7ad4752d.js";import{E as pe,I as me,D as _e}from"./el-card-60d3f957.js";/* empty css              */import"./el-tag-56496b10.js";import{C as ve}from"./index-26753d2d.js";import"./index-1c65cf2d.js";import{F as fe}from"./index-f4c47f9e.js";import{E as he,a as ge}from"./el-select-ab6db4a7.js";import"./el-popper-6266427f.js";import{c as ye,s as be}from"./index-f690294c.js";import{N as ke}from"./index-d7f0187b.js";import{d as Ce,g as we,b as Ie,e as De}from"./gradeDetermination-dde8d4d8.js";import{s as q,a as xe,c as O}from"./index-6a3a1558.js";import"./mount-component-b771f396.js";import"./index-84d329ed.js";import"./use-id-c21c8892.js";import"./index-22004baa.js";import"./index-4e11758a.js";import"./request-352f5424.js";const[G,Se]=z("radio-group"),Ve={disabled:Boolean,iconSize:$,direction:String,modelValue:ee,checkedColor:String},Z=Symbol(G);var Je=A({name:G,props:Ve,emits:["change","update:modelValue"],setup(s,{emit:n,slots:u}){const{linkChildren:e}=E.useChildren(Z),m=r=>n("update:modelValue",r);return X(()=>s.modelValue,r=>n("change",r)),e({props:s,updateValue:m}),E.useCustomFieldValue(()=>s.modelValue),()=>{var r;return c("div",{class:Se([s.direction]),role:"radiogroup"},[(r=u.default)==null?void 0:r.call(u)])}}});const Re=H(Je),[je,Le]=z("radio");var Fe=A({name:je,props:ye,emits:["update:modelValue"],setup(s,{emit:n,slots:u}){const{parent:e}=E.useParent(Z),m=()=>(e?e.props.modelValue:s.modelValue)===s.name,r=()=>{e?e.updateValue(s.name):n("update:modelValue",s.name)};return()=>c(be,te({bem:Le,role:"radio",parent:e,checked:m(),onToggle:r},s),ae(u,["default","icon"]))}});const Ne=H(Fe);function Pe(s){let n=s.split(","),u=n[0].match(/:(.*?);/)[1],e=atob(n[1]),m=e.length,r=new Uint8Array(m);for(;m--;)r[m]=e.charCodeAt(m);let y=Math.random().toString(36).slice(-8),h=u.split("/")[1];return new File([r],y+"."+h,{type:u})}const Ue={setup(){const s=le(),n=ne(),u=d(""),e=d(""),m=d(""),r=d(""),y=d(""),h=d(""),b=d([]),S=d([]),k=d([]),R=d(!1),F=d(!1),j=d([]),p=se({yjtJyInformationData:{},typeCodeList:[],alterReasonList:[]}),C=d(!1);p.yjtJyInformationData=JSON.parse(decodeURIComponent(n.query.yjtJyInformation));const V=d(JSON.parse(decodeURIComponent(n.query.exterior))),o=d(JSON.parse(decodeURIComponent(n.query.tabIndex)));P.await("takePhoto",l=>{if(l!="null"){let i={};i.index=b.value.length+1,i.base64Img=l,b.value.push(i),S.value.push(l);let t=new FormData,_="/cathodeCopper/"+p.yjtJyInformationData.batchgroup+"/"+p.yjtJyInformationData.batchnumber;t.append("file",Pe(l)),t.append("path",_),Ce(t).then(w=>{let I={};I.fileName=w.data.fileName,I.fileUrl=w.data.fileUrl,I.index=b.value.length,k.value.push(I)}).catch(w=>{console.log(w)})}});const N=()=>{P.takePhoto()},L=(l,i)=>{k.value=k.value.filter(t=>t.index!=l),b.value=b.value.filter(t=>t.index!=l),S.value=S.value.filter(t=>t!=i)},Q=()=>{j.value=S.value,R.value=!0};V.value=="1"?(u.value="qualified",e.value="合格品类型"):V.value=="2"&&(u.value="unqualified",e.value="不合格品类型"),re(()=>{P.register("goback",()=>{s.push({path:"/gradeDetermination",query:{barcode:p.yjtJyInformationData.barcode,tabState:o.value}})}),Y(u.value),M()});const K=()=>{s.push({path:"/gradeDetermination",query:{barcode:p.yjtJyInformationData.barcode,tabState:o.value}})},W=()=>{if(C.value=!0,k.value.length==0)return q({message:"请上传质检照片",type:"fail",overlay:!0,className:"particulars-detail-popup"}),C.value=!1,!1;if(o.value==1&&!r.value)return q({message:"请选择或者填写改判理由",type:"fail",overlay:!0,className:"particulars-detail-popup"}),C.value=!1,!1;xe({duration:0,forbidClick:!0,className:"particulars-detail-popup",overlay:!0,message:"正在质检..."});let l={data:[],active:"",exterior:"",remarks:"",alterReason:"",typeCodeChecked:"",fileList:[],labelFileList:[]},i=[];i.push(p.yjtJyInformationData),l.data=i,l.typeCodeChecked=y.value,l.active=o.value,l.exterior=V.value,l.remarks=m.value,l.alterReason=r.value,l.fileList=k.value,De(l).then(t=>{O(),t.data.code==200&&(q({message:"质检成功",type:"success",className:"particulars-detail-popup",overlay:!0}),C.value=!1,s.push({path:"/gradeDetermination",query:{barcode:p.yjtJyInformationData.barcode,tabState:"1"}}))}).catch(t=>{console.log(t),C.value=!1,O()})},Y=l=>{let i={};i.typeCode=l,we(i).then(t=>{t.data.code==200&&(p.typeCodeList=t.data.data,y.value=String(p.typeCodeList[0].id))}).catch(t=>{console.log(t)})},M=()=>{let l={},i={},t={};t.limit=9999,t.offset=1,t.blockId="paramBlock",t.data={},i.paramBlock=t,l.blocks=i,Ie(l).then(_=>{p.alterReasonList=_.data.blocks.resultBlock.data}).catch(_=>{console.log(_)})};return{imgList:j,showImage:R,showLabelImage:F,fileList:b,base64ImgList:S,imagePath:k,takePhotoState:h,alterReason:r,remarks:m,typeCode:u,typeCodeText:e,listData:p,exterior:V,tabIndex:o,typeCodeChecked:y,disabled:C,seeImg:Q,takePhotoZJ:N,onClickLeft:K,dateFormat:(l,i)=>{let t,_=new Date(i);const w={"Y+":_.getFullYear().toString(),"m+":(_.getMonth()+1).toString(),"d+":_.getDate().toString(),"H+":_.getHours().toString(),"M+":_.getMinutes().toString(),"S+":_.getSeconds().toString()};for(let I in w)t=new RegExp("("+I+")").exec(l),t&&(l=l.replace(t[1],t[1].length==1?w[I]:w[I].padStart(t[1].length,"0")));return l},beforeDelete:L,conservation:W,getTypeCodeData:Y,getAlterReasonQuery:M}}},f=s=>(ce("data-v-7d8230da"),s=s(),ue(),s),Be={class:"container"},qe={class:"header"},Ee={class:"content"},Ye=f(()=>a("span",{style:{"font-weight":"bold"}},"编号：",-1)),Me=f(()=>a("span",{style:{"font-weight":"bold"}},"重量：",-1)),Te=f(()=>a("span",{style:{"font-weight":"bold"}},"标准：",-1)),Oe=f(()=>a("span",{style:{"font-weight":"bold"}},"计量员：",-1)),ze=f(()=>a("span",{style:{"font-weight":"bold"}},"扫描人：",-1)),Ae=f(()=>a("span",{style:{"font-weight":"bold"}},"生产日期：",-1)),He=f(()=>a("span",{style:{color:"red"}},"*",-1)),Ge=f(()=>a("span",{style:{color:"red"}},"*",-1)),Ze={class:"van-uploader"},Qe={class:"van-uploader__wrapper"},Ke={class:"van-image van-uploader__preview-image"},We=["src"],Xe=["onClick"],$e=f(()=>a("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),ea=[$e],aa=f(()=>a("i",{class:"van-badge__wrapper van-icon van-icon-photograph van-uploader__upload-icon"},null,-1)),ta=[aa],oa={key:0},la=f(()=>a("span",{style:{color:"red"}},"*",-1));function na(s,n,u,e,m,r){const y=ke,h=_e,b=Ne,S=Re,k=he,R=ge,F=fe,j=ve,p=pe,C=ie,V=me;return D(),J("main",null,[a("div",Be,[a("div",qe,[c(y,{title:"品级质检",class:"page-nav-bar","left-arrow":"",onClickLeft:e.onClickLeft},null,8,["onClickLeft"])]),a("div",Ee,[c(p,{class:"box-card",shadow:"always"},{default:v(()=>[c(h,{"content-position":"left"},{default:v(()=>[x("基本信息")]),_:1}),a("div",null,[a("p",null,[Ye,a("span",null,g(e.listData.yjtJyInformationData.batchnumber),1)]),a("p",null,[Me,a("span",null,g(parseFloat(e.listData.yjtJyInformationData.suttle))+g(e.listData.yjtJyInformationData.unit),1)]),a("p",null,[Te,a("span",null,g(e.listData.yjtJyInformationData.standard),1)]),a("p",null,[Oe,a("span",null,g(e.listData.yjtJyInformationData.suttleperson),1),x("      "),ze,a("span",null,g(e.listData.yjtJyInformationData.scanUser),1)]),a("p",null,[Ae,a("span",null,g(e.dateFormat("YYYY-mm-dd HH:MM:SS",e.listData.yjtJyInformationData.proDate)),1)])]),a("div",null,[c(h,{"content-position":"left"},{default:v(()=>[He,x(g(e.typeCodeText),1)]),_:1}),c(S,{modelValue:e.typeCodeChecked,"onUpdate:modelValue":n[0]||(n[0]=o=>e.typeCodeChecked=o),direction:"horizontal"},{default:v(()=>[(D(!0),J(U,null,B(e.listData.typeCodeList,(o,N)=>(D(),T(b,{name:String(o.id)},{default:v(()=>[x(g(o.name),1)]),_:2},1032,["name"]))),256))]),_:1},8,["modelValue"])]),a("div",null,[c(h,{"content-position":"left"},{default:v(()=>[Ge,x(" 质检照片")]),_:1}),a("div",Ze,[a("div",Qe,[(D(!0),J(U,null,B(e.fileList,(o,N)=>(D(),J("div",{class:"van-uploader__preview",key:o.index},[a("div",Ke,[a("img",{class:"van-image__img",src:o.base64Img,style:{"object-fit":"cover"},onClick:n[1]||(n[1]=(...L)=>e.seeImg&&e.seeImg(...L))},null,8,We)]),a("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:L=>e.beforeDelete(o.index,o.base64Img)},ea,8,Xe)]))),128)),a("div",{class:"van-uploader__upload",onClick:n[2]||(n[2]=(...o)=>e.takePhotoZJ&&e.takePhotoZJ(...o))},ta)])])]),e.tabIndex==1?(D(),J("div",oa,[c(h,{"content-position":"left"},{default:v(()=>[la,x("改判理由")]),_:1}),c(R,{modelValue:e.alterReason,"onUpdate:modelValue":n[3]||(n[3]=o=>e.alterReason=o),filterable:"",clearable:"","allow-create":"",placeholder:"改判理由",style:{width:"100%"}},{default:v(()=>[(D(!0),J(U,null,B(e.listData.alterReasonList,o=>(D(),T(k,{key:o.alterReason,label:o.alterReason,value:o.alterReason},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):de("",!0),a("div",null,[c(h,{"content-position":"left"},{default:v(()=>[x("备注")]),_:1}),c(j,{inset:""},{default:v(()=>[c(F,{modelValue:e.remarks,"onUpdate:modelValue":n[4]||(n[4]=o=>e.remarks=o),rows:"1",autosize:"",label:"备注",type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})])]),_:1}),c(C,{type:"primary",size:"large",disabled:e.disabled,style:{width:"80%",position:"absolute",left:"10%","margin-top":"15px","background-color":"#003363",color:"#FFFFFF"},onClick:e.conservation},{default:v(()=>[x("提交 ")]),_:1},8,["disabled","onClick"]),c(V,{show:e.showImage,"onUpdate:show":n[5]||(n[5]=o=>e.showImage=o),images:e.imgList,closeable:!0,loop:!1,closeOnPopstate:!0},null,8,["show","images"])])])])}const xa=oe(Ue,[["render",na],["__scopeId","data-v-7d8230da"]]);export{xa as default};
