import"./el-tag-acf0ed7e.js";import{E as ne}from"./el-overlay-d38babd4.js";import{_ as le,u as ie,D as ce,r as p,a as de,E as re,H as W,t as v,o as ue,b as S,c as X,d as l,w as _,i as o,e as G,j as z,F as Y,I as pe,O as me,P as K,N as he,V as O,M as _e,p as fe,h as ge,W as ve,a1 as we,a2 as be,Y as ye,a0 as Fe,R as Ce,a3 as ke}from"./index-703aaad1.js";/* empty css              */import{E as xe,a as Be}from"./el-select-e167463c.js";import"./el-popper-8f138f0c.js";import{E as Te,a as ze}from"./el-table-column-b4960c42.js";/* empty css              */import{B as w}from"./bignumber-266e6c56.js";import{c as Q,b as Ee,s as He}from"./pickWith-4c609bcf.js";import{_ as Re,a as De}from"./btn_shoudong-07961c15.js";import{_ as Ie}from"./btn_tichu-bca5bbb8.js";import{a as m,s as J}from"./function-call-60d2426a.js";import"./index-5f02ee64.js";import"./use-global-config-3a66211f.js";import"./objects-1d7d6bfe.js";import"./index-8e66d421.js";const Le={setup(){const b=ie();ce();const s=p([]),g=de(),t=p(""),I=p(""),f=p("0"),x=p(""),B=p("0"),C=p("0"),E=p("0"),k=p(!1),T=p(""),y=p(""),N=p(""),V=p(""),F=re({barCodeSelectList:[]});W.await("scanner",e=>{if(b.currentRoute.value.path=="/pickWith")if(e!="null"){let a=e;if(new RegExp(/^124010[1-9][0-9]{2}(0[1-9]|1[0-2])((0[1-9])|((1|2)[0-9])|30|31)[0-9]{12}$/).test(a)&&a.length===25){let r={};r.fBarcode=a,Q(r).then(i=>{if(i.data.data)return M(a).then(u=>{let H=u.shengchanriqi,R=u.kunxuhao,D=u.barcode,L=u.kunjingzhong,se={date:H,number:R,barcode:D,weight:L};P(v(s.value),se)});{let u="";i.data.distinguish=="1"?u='<span style="font-size: 18px;color: red">'+i.data.message+"</span>":i.data.distinguish=="2"?u='<span style="font-size: 18px;color: #0e80d2">'+i.data.message+"</span>":u='<span style="font-size: 18px">'+i.data.message+"</span>",m({title:"提示",width:"600",allowHtml:!0,message:u}).then(()=>{})}})}else m({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">对不起，此条码不符合规范</span>'}).then(()=>{})}else m({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">数据获取失败</span>'}).then(()=>{})});const j=()=>{b.push({path:"/pickWithQueryInfoData"})},U=()=>{k.value=!1},A=()=>{k.value=!0};let n="";const Z=(e,a,c)=>{n=v(e)},$=()=>{W.scan()};ue(()=>{let e=v(g.state.chukudanListInfo);v(g.state.carInfo.pizhong)&&(B.value=v(g.state.carInfo.pizhong).toFixed(4)),I.value=new w(e.F_PLANSUTTLE).minus(e.F_SUTTLE).toFixed(4),x.value=new w(e.F_PLANSUTTLE).minus(e.F_SUTTLE).toFixed(4),E.value=new w(B.value).plus(f.value).toFixed(4)});const ee=()=>{if(y.value=="")return m({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">请选择条形码</span>'}).then(()=>{}),!1;k.value=!1;let e=y.value;if(new RegExp(/^124010[1-9][0-9]{2}(0[1-9]|1[0-2])((0[1-9])|((1|2)[0-9])|30|31)[0-9]{12}$/).test(e)&&e.length===25){let d={};d.fBarcode=e,Q(d).then(r=>{if(r.data.data)return M(e).then(i=>{let u=i.shengchanriqi,H=i.kunxuhao,R=i.barcode,D=i.kunjingzhong,L={date:u,number:H,barcode:R,weight:D};P(v(s.value),L)});{let i="";r.data.distinguish=="1"?i='<span style="font-size: 18px;color: red">'+r.data.message+"</span>":r.data.distinguish=="2"?i='<span style="font-size: 18px;color: #0e80d2">'+r.data.message+"</span>":i='<span style="font-size: 18px">'+r.data.message+"</span>",m({title:"提示",width:"600",allowHtml:!0,message:i}).then(()=>{})}})}else m({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">对不起，此条码不符合规范</span>'}).then(()=>{})},te=e=>{y.value="";let c={strBatchno:e.F_BATCHNUMBER+"-"+e.F_BATCHGROUP};Ee(c).then(d=>{F.barCodeSelectList=d.data.data,F.barCodeSelectList.length>0?pe({message:"数据查询成功",type:"success",className:"particulars-detail-popup",overlay:!0}):m({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">没有查询到对应的条码数据</span>'}).then(()=>{})}).catch(d=>{console.log(d)})},ae=()=>{n?J({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">是否要剔除当前所选数据？</span>'}).then(()=>{let e=s.value.filter(a=>a.barcode!=n.barcode);s.value=e,T.value="edit",q(e,n),n=""}).catch(e=>{console.log(e)}):m({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">请选择要剔除的的数据</span>'}).then(()=>{})},oe=()=>{if(s.value.length==0)return m({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">没有要处理的数据</span>'}).then(()=>{}),!1;J({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">是否已完成扫描？</span>'}).then(()=>{me({duration:0,forbidClick:!0,overlay:!0,className:"particulars-detail-popup",message:"拣配中..."});let e=v(g.state.chukudanListInfo),a=v(g.state.carInfo),c={};c.F_DELIVERYNO=e.F_DELIVERYNO,c.strSuttle=f.value,c.strTruckNo=a.chehao,c.weighthousename=a.chengfang,c.id=a.danjuhao,a.DataId?c.strDataId=a.DataId:c.strDataId="";let d=v(s.value).map(r=>r.barcode+",").join("");c.strBarcodes=d.substring(0,d.length-1),He(c).then(r=>{K(),r.data.code=="200"?(s.value=[],m({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">'+r.data.message+"</span>"}).then(()=>{g.commit("setPickWithScroll",0),g.commit("setChukudanListInfo",{}),g.commit("setCarInfo",{}),b.push({path:"/pickWithQueryListData"})})):m({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">'+r.data.message+"</span>"}).then(()=>{})})}).catch(e=>{console.log(e),K()})},q=(e,a)=>{T.value=="add"?f.value=new w(f.value).plus(new w(a.weight).dividedBy(1e3).toNumber()).toFixed(4):f.value=new w(f.value).minus(new w(a.weight).dividedBy(1e3).toNumber()).toFixed(4),x.value=new w(I.value).minus(f.value).toFixed(4),E.value=new w(B.value).plus(f.value).toFixed(4),C.value=e.length,s.value=e,t.value=Math.random(),x.value<0&&m({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">缺少数值已为负数</span>'}).then(()=>{})},M=e=>{let a=e.split("");const c=a.slice(0,3).join(""),d=a.slice(3,5).join(""),r=a.slice(5,7).join(""),i=a.slice(7,13).join(""),u=a.slice(13,17).join(""),H=a.slice(17,20).join(""),R=a.slice(20,24).join("")+"."+a[24];return new Promise((D,L)=>{D({barcode:e,qiyedaima:c,chanpinleibie:d,chanpindengji:r,shengchanriqi:i,chanpinpihao:u,kunxuhao:H,kunjingzhong:R})})},P=(e,a)=>{if(e.find(d=>d.barcode===a.barcode))m({title:"提示",width:"600",allowHtml:!0,message:'<span style="font-size: 18px">该批次已经选择，请勿重复选择</span>'}).then(()=>{});else{let d=[];e.unshift(a),d=e,T.value="add",q(d,a)}};return{typeName:T,barCodeSelect:y,F_BATCHGROUP:N,F_BATCHNUMBER:V,listData:F,itemKey:t,yingj:I,yij1:f,ques:x,pizhong:B,yij2:C,pz:E,tableData:s,centerDialogVisibleTXM:k,passedTXMClick:ee,onSubmit:te,closeTXMClick:U,checkIfExist:P,decode:M,scanCode:$,onClickLeft:j,onHandle:A,onConfirm:oe,selectRow:Z,onDelete:ae}}},h=b=>(fe("data-v-66a4c50c"),b=b(),ge(),b),Se={class:"container"},Ne={class:"info-container"},Ve=h(()=>o("span",{class:"title"},"应拣",-1)),je=h(()=>o("span",{class:"title"},"已拣",-1)),Ue=h(()=>o("span",{class:"title"},"缺少",-1)),Ae=h(()=>o("span",{class:"title"},"皮重",-1)),Me=h(()=>o("span",{class:"title"},"捆数",-1)),Pe=h(()=>o("span",{class:"title"},"合计",-1)),Oe={class:"btn-area"},qe=h(()=>o("img",{src:Re},null,-1)),We=h(()=>o("div",null,"确认",-1)),Xe=[qe,We],Ge=h(()=>o("img",{src:De},null,-1)),Ye=h(()=>o("div",null,"手动",-1)),Ke=[Ge,Ye],Qe=h(()=>o("img",{src:Ie},null,-1)),Je=h(()=>o("div",null,"剔除",-1)),Ze=[Qe,Je],$e={style:{margin:"16px"}},et={style:{"margin-top":"10px"}},tt=h(()=>o("p",null,"条形码",-1));function at(b,s,g,t,I,f){const x=ve,B=he,C=ze,E=Te,k=we,T=be,y=ye,N=xe,V=Be,F=Fe,j=Ce,U=ke,A=ne;return S(),X(Y,null,[l(B,{title:"拣配",class:"page-nav-bar","left-arrow":"",onClickLeft:t.onClickLeft},{right:_(()=>[l(x,{onClick:t.scanCode,style:{color:"#FFFFFF"},name:"scan",size:"40"},null,8,["onClick"])]),_:1},8,["onClickLeft"]),o("div",Se,[(S(),G(E,{data:t.tableData,style:{height:"260px"},id:"data-area1",key:t.itemKey,"highlight-current-row":"",onRowClick:t.selectRow},{default:_(()=>[l(C,{fixed:"",prop:"date",label:"日期"}),l(C,{prop:"number",label:"包号"}),l(C,{prop:"weight",label:"重量"}),l(C,{prop:"barcode",label:"条码",width:"250"})]),_:1},8,["data","onRowClick"])),o("div",Ne,[Ve,je,Ue,o("span",null,z(t.yingj),1),o("span",null,z(t.yij1),1),o("span",null,z(t.ques),1),Ae,Me,Pe,o("span",null,z(t.pizhong),1),o("span",null,z(t.yij2),1),o("span",null,z(t.pz),1)]),o("div",Oe,[o("div",{onClick:s[0]||(s[0]=(...n)=>t.onConfirm&&t.onConfirm(...n))},Xe),o("div",{onClick:s[1]||(s[1]=(...n)=>t.onHandle&&t.onHandle(...n))},Ke),o("div",{onClick:s[2]||(s[2]=(...n)=>t.onDelete&&t.onDelete(...n))},Ze)])]),l(A,{modelValue:t.centerDialogVisibleTXM,"onUpdate:modelValue":s[6]||(s[6]=n=>t.centerDialogVisibleTXM=n),title:"手动不合格条码",width:"96%","align-center":""},{default:_(()=>[l(U,{onSubmit:t.onSubmit},{default:_(()=>[l(T,{inset:""},{default:_(()=>[l(k,{modelValue:t.F_BATCHGROUP,"onUpdate:modelValue":s[3]||(s[3]=n=>t.F_BATCHGROUP=n),name:"F_BATCHGROUP",label:"批次号",placeholder:"批次号(四位)",rules:[{required:!0,message:"请填写批次号"}]},null,8,["modelValue"]),l(k,{modelValue:t.F_BATCHNUMBER,"onUpdate:modelValue":s[4]||(s[4]=n=>t.F_BATCHNUMBER=n),name:"F_BATCHNUMBER",label:"编号",placeholder:"编号(三位)",rules:[{required:!0,message:"请填写编号"}]},null,8,["modelValue"])]),_:1}),o("div",$e,[l(y,{square:"",icon:"search",block:"",type:"primary","native-type":"submit",style:{"background-color":"#003363",color:"#FFFFFF"}},{default:_(()=>[O(" 查询 ")]),_:1}),o("div",et,[tt,l(V,{modelValue:t.barCodeSelect,"onUpdate:modelValue":s[5]||(s[5]=n=>t.barCodeSelect=n),placeholder:"条形码",style:{width:"100%"}},{default:_(()=>[(S(!0),X(Y,null,_e(t.listData.barCodeSelectList,n=>(S(),G(N,{key:n.F_BARCODE,label:n.F_BARCODE,value:n.F_BARCODE},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),l(j,{style:{"margin-top":"15px"}},{default:_(()=>[l(F,{span:"2"}),l(F,{span:"10"},{default:_(()=>[l(y,{icon:"passed",style:{"background-color":"#003363",color:"#FFFFFF"},onClick:t.passedTXMClick},{default:_(()=>[O("确定 ")]),_:1},8,["onClick"])]),_:1}),l(F,{span:"10",style:{"text-align":"center"}},{default:_(()=>[l(y,{icon:"close",style:{"background-color":"red",color:"#FFFFFF"},onClick:t.closeTXMClick},{default:_(()=>[O("退出 ")]),_:1},8,["onClick"])]),_:1}),l(F,{span:"2"})]),_:1})])]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"])],64)}const bt=le(Le,[["render",at],["__scopeId","data-v-66a4c50c"]]);export{bt as default};
