import{_ as L,a as R,k as U,r as F,m as N,n as z,Q as V,o as S,c as x,b as _,w as v,F as j,i as J,D as M,S as B,N as P,K as Y,H as C,d as n,e as D,z as A,G as q,L as E,U as T,V as G,W as K,X as O,Y as Q}from"./index-cd7d6a53.js";import"./base-749988d4.js";import{E as X}from"./el-card-f583305c.js";/* empty css              *//* empty css              *//* empty css              */function Z(r,c){var y=.52;return parseInt((r.size/1024).toFixed(2))<1024&&(y=.85),5*1024<parseInt((r.size/1024).toFixed(2))&&(y=.92),c&&(y=c),r[0]?Promise.all(Array.from(r).map(t=>this.compressImg(t,y))):new Promise(t=>{if((r.size/1024).toFixed(2)<300)t({file:r});else{const k=new FileReader;k.onload=({target:{result:w}})=>{const o=new Image;o.onload=async()=>{const s=document.createElement("canvas"),I=s.getContext("2d");var p=o.width,u=o.height,i=o.width,d=o.height;if(1*1024<=parseInt((r.size/1024).toFixed(2))&&parseInt((r.size/1024).toFixed(2))<=10*1024){var f=1600,m=1600;p=i,u=d,(i>f||d>m)&&(i/d>f/m?(p=f,u=Math.round(f*(d/i))):(u=m,p=Math.round(m*(i/d))))}10*1024<=parseInt((r.size/1024).toFixed(2))&&parseInt((r.size/1024).toFixed(2))<=20*1024&&(f=1400,m=1400,p=i,u=d,(i>f||d>m)&&(i/d>f/m?(p=f,u=Math.round(f*(d/i))):(u=m,p=Math.round(m*(i/d))))),s.width=p,s.height=u,I.clearRect(0,0,p,u),I.drawImage(o,0,0,p,u);const e=s.toDataURL("image/jpeg",y),l=atob(e.split(",")[1]);let a=l.length;const g=new Uint8Array(new ArrayBuffer(a));for(;a--;)g[a]=l.charCodeAt(a);const h=new File([g],r.name,{type:"image/jpeg"});t({file:h,origin:r,beforeSrc:w,afterSrc:e,beforeKB:Number((r.size/1024).toFixed(2)),afterKB:Number((h.size/1024).toFixed(2))})},o.src=w},k.readAsDataURL(r)}})}const H={setup(){const r=R(),c=U(),y=F(""),t=F(""),k=F(""),w=F(""),o=N({yjtJyInformationData:{},typeCodeList:[],fileList:[],imagePath:[]});o.yjtJyInformationData=JSON.parse(decodeURIComponent(c.query.yjtJyInformation));const s=F(JSON.parse(decodeURIComponent(c.query.exterior))),I=F(JSON.parse(decodeURIComponent(c.query.tabIndex)));s.value=="1"?(y.value="qualified",t.value="合格品类型"):s.value=="2"&&(y.value="unqualified",t.value="不合格品类型"),z(()=>{f(y.value)});const p=()=>{r.back()},u=e=>(o.imagePath=o.imagePath.filter(l=>l.fileName!=e.file.name),!0),i=()=>{if(o.imagePath.length==0)return J({message:"请上传照片",type:"fail",className:"particulars-detail-popup"}),!1;let e={data:[],active:"",exterior:"",remarks:"",typeCodeChecked:"",fileList:[]},l=[];l.push(o.yjtJyInformationData),e.data=l,e.typeCodeChecked=w.value,e.active=I.value,e.exterior=s.value,e.remarks=k.value,e.fileList=o.imagePath,M(e).then(a=>{a.data.code==200&&(J({message:"质检成功",type:"success",className:"particulars-detail-popup",overlay:!0}),r.back())}).catch(a=>{console.log(a)})},d=e=>{Z(e.file,"0.9").then(l=>{let a=new FormData,g="/cathodeCopper/"+o.yjtJyInformationData.batchgroup+"/"+o.yjtJyInformationData.batchnumber;a.append("file",l.file),a.append("path",g);let h={};B(a).then(b=>{h.fileName=b.data.fileName,h.fileUrl=b.data.fileUrl,o.imagePath.push(h)}).catch(b=>{console.log(b)})})};function f(e){let l={};l.typeCode=e,V(l).then(a=>{a.data.code==200&&(o.typeCodeList=a.data.data,w.value=String(o.typeCodeList[0].id))}).catch(a=>{console.log(a)})}return{remarks:k,typeCode:y,typeCodeText:t,listData:o,exterior:s,tabIndex:I,typeCodeChecked:w,onClickLeft:p,dateFormat:(e,l)=>{let a,g=new Date(l);const h={"Y+":g.getFullYear().toString(),"m+":(g.getMonth()+1).toString(),"d+":g.getDate().toString(),"H+":g.getHours().toString(),"M+":g.getMinutes().toString(),"S+":g.getSeconds().toString()};for(let b in h)a=new RegExp("("+b+")").exec(e),a&&(e=e.replace(a[1],a[1].length==1?h[b]:h[b].padStart(a[1].length,"0")));return e},onRead:d,beforeDelete:u,conservation:i}}},W=n("span",{style:{"font-weight":"bold"}},"编号：",-1),$=n("span",{style:{"font-weight":"bold"}},"重量：",-1),ee=n("span",{style:{"font-weight":"bold"}},"标准：",-1),te=n("span",{style:{"font-weight":"bold"}},"计量员：",-1),ae=n("span",{style:{"font-weight":"bold"}},"扫描人：",-1),oe=n("span",{style:{"font-weight":"bold"}},"生产日期：",-1),ne=n("span",{style:{color:"red"}},"*",-1),re=n("span",{style:{color:"red"}},"*",-1);function le(r,c,y,t,k,w){const o=P,s=E,I=T,p=G,u=K,i=O,d=Q,f=X,m=Y;return S(),x(j,null,[_(o,{title:"品级质检",class:"page-nav-bar","left-arrow":"",onClickLeft:t.onClickLeft},null,8,["onClickLeft"]),_(f,{class:"box-card",shadow:"always",style:{"margin-top":"5px"}},{default:v(()=>[_(s,{"content-position":"left"},{default:v(()=>[C("基本信息")]),_:1}),n("div",null,[n("p",null,[W,n("span",null,D(t.listData.yjtJyInformationData.batchnumber),1)]),n("p",null,[$,n("span",null,D(parseFloat(t.listData.yjtJyInformationData.suttle))+D(t.listData.yjtJyInformationData.unit),1)]),n("p",null,[ee,n("span",null,D(t.listData.yjtJyInformationData.standard),1)]),n("p",null,[te,n("span",null,D(t.listData.yjtJyInformationData.suttleperson),1),C("     "),ae,n("span",null,D(t.listData.yjtJyInformationData.scanUser),1)]),n("p",null,[oe,C(D(t.dateFormat("YYYY-mm-dd HH:MM:SS",t.listData.yjtJyInformationData.proDate)),1)])]),n("div",null,[_(s,{"content-position":"left"},{default:v(()=>[ne,C(D(t.typeCodeText),1)]),_:1}),_(p,{modelValue:t.typeCodeChecked,"onUpdate:modelValue":c[0]||(c[0]=e=>t.typeCodeChecked=e),direction:"horizontal"},{default:v(()=>[(S(!0),x(j,null,A(t.listData.typeCodeList,(e,l)=>(S(),q(I,{name:String(e.id)},{default:v(()=>[C(D(e.name),1)]),_:2},1032,["name"]))),256))]),_:1},8,["modelValue"])]),n("div",null,[_(s,{"content-position":"left"},{default:v(()=>[re,C(" 上传照片")]),_:1}),_(u,{modelValue:t.listData.fileList,"onUpdate:modelValue":c[1]||(c[1]=e=>t.listData.fileList=e),"after-read":t.onRead,"before-delete":t.beforeDelete},null,8,["modelValue","after-read","before-delete"])]),n("div",null,[_(s,{"content-position":"left"},{default:v(()=>[C("备注")]),_:1}),_(d,{inset:""},{default:v(()=>[_(i,{modelValue:t.remarks,"onUpdate:modelValue":c[2]||(c[2]=e=>t.remarks=e),rows:"1",autosize:"",label:"备注",type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})])]),_:1}),_(m,{type:"primary",size:"large",style:{width:"80%",position:"absolute",left:"10%","margin-top":"15px"},onClick:t.conservation},{default:v(()=>[C("提交 ")]),_:1},8,["onClick"])],64)}const fe=L(H,[["render",le]]);export{fe as default};
