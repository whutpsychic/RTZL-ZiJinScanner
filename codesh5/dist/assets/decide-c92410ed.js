import{_ as $,u as ee,I as ae,r as i,J as te,f as Q,o as oe,b as v,c as h,j as a,d as c,w as m,s as N,N as le,X as ne,S as se,U as y,k as b,F as U,O as P,e as M,g as O,Y as ie,a3 as re,a4 as de,a0 as ce,a1 as pe,p as ue,i as _e}from"./index-8b63aa92.js";import{E as ve}from"./el-card-3523e71e.js";/* empty css              */import"./el-tag-0dd03ffc.js";import{E as me,a as fe}from"./el-select-3852e214.js";import"./el-popper-95a192dd.js";/* empty css              *//* empty css              */import{d as Y,g as he,b as ge,e as ye}from"./gradeDetermination-eb58a5b1.js";import"./index-8dcd196a.js";function E(g){let n=g.split(","),k=n[0].match(/:(.*?);/)[1],e=atob(n[1]),w=e.length,L=new Uint8Array(w);for(;w--;)L[w]=e.charCodeAt(w);let j=Math.random().toString(36).slice(-8),r=k.split("/")[1];return new File([L],j+"."+r,{type:k})}const be={setup(){const g=ee(),n=ae(),k=i(""),e=i(""),w=i(""),L=i(""),j=i(""),r=i(""),I=i([]),S=i([]),C=i([]),x=i([]),J=i([]),D=i([]),R=i(!1),V=i(!1),B=i([]),o=te({yjtJyInformationData:{},typeCodeList:[],alterReasonList:[]});o.yjtJyInformationData=JSON.parse(decodeURIComponent(n.query.yjtJyInformation));const F=i(JSON.parse(decodeURIComponent(n.query.exterior))),f=i(JSON.parse(decodeURIComponent(n.query.tabIndex)));Q.await("takePhoto",l=>{if(l!="null"){if(r.value=="0"){let s={};s.index=I.value.length+1,s.base64Img=l,I.value.push(s),S.value.push(l);let t=new FormData,d="/cathodeCopper/"+o.yjtJyInformationData.batchgroup+"/"+o.yjtJyInformationData.batchnumber;t.append("file",E(l)),t.append("path",d),Y(t).then(u=>{let _={};_.fileName=u.data.fileName,_.fileUrl=u.data.fileUrl,_.index=I.value.length,C.value.push(_)}).catch(u=>{console.log(u)})}if(r.value=="1"){let s={};s.index=x.value.length+1,s.base64Img=l,x.value.push(s),J.value.push(l);let t=new FormData,d="/cathodeCopperLabel/"+o.yjtJyInformationData.batchnumber;t.append("file",E(l)),t.append("path",d),Y(t).then(u=>{let _={};_.fileName=u.data.fileName,_.fileUrl=u.data.fileUrl,_.index=x.value.length,D.value.push(_)}).catch(u=>{console.log(u)})}}});const q=()=>{r.value="0",Q.takePhoto()},T=(l,s)=>{C.value=C.value.filter(t=>t.index!=l),I.value=I.value.filter(t=>t.index!=l),S.value=S.value.filter(t=>t!=s)},H=()=>{B.value=S.value,R.value=!0},z=()=>{r.value="1",Q.takePhoto()},A=(l,s)=>{D.value=D.value.filter(t=>t.index!=l),x.value=x.value.filter(t=>t.index!=l),J.value=J.value.filter(t=>t!=s)},Z=()=>{B.value=J.value,R.value=!0};F.value=="1"?(k.value="qualified",e.value="合格品类型"):F.value=="2"&&(k.value="unqualified",e.value="不合格品类型"),oe(()=>{K(k.value),W()});const G=()=>{g.back()},X=()=>{if(C.value.length==0)return N({message:"请上传质检照片",type:"fail",className:"particulars-detail-popup"}),!1;if(f.value==0&&D.value.length==0)return N({message:"请上传标签照片",type:"fail",className:"particulars-detail-popup"}),!1;if(f.value==1&&!L.value)return N({message:"请选择或者填写改判理由",type:"fail",className:"particulars-detail-popup"}),!1;let l={data:[],active:"",exterior:"",remarks:"",alterReason:"",typeCodeChecked:"",fileList:[],labelFileList:[]},s=[];s.push(o.yjtJyInformationData),l.data=s,l.typeCodeChecked=j.value,l.active=f.value,l.exterior=F.value,l.remarks=w.value,l.alterReason=L.value,l.fileList=C.value,l.labelFileList=D.value,ye(l).then(t=>{t.data.code==200&&(N({message:"质检成功",type:"success",className:"particulars-detail-popup",overlay:!0}),g.back())}).catch(t=>{console.log(t)})};function K(l){let s={};s.typeCode=l,he(s).then(t=>{t.data.code==200&&(o.typeCodeList=t.data.data,j.value=String(o.typeCodeList[0].id))}).catch(t=>{console.log(t)})}function W(){let l={},s={},t={};t.limit=9999,t.offset=1,t.blockId="paramBlock",t.data={},s.paramBlock=t,l.blocks=s,ge(l).then(d=>{o.alterReasonList=d.data.blocks.resultBlock.data}).catch(d=>{console.log(d)})}return{imgList:B,showImage:R,showLabelImage:V,fileList:I,base64ImgList:S,imagePath:C,labelFileList:x,labelImagePath:D,takePhotoState:r,alterReason:L,remarks:w,typeCode:k,typeCodeText:e,listData:o,exterior:F,tabIndex:f,typeCodeChecked:j,seeImg:H,seeImgBQ:Z,takePhotoZJ:q,takePhotoBQ:z,onClickLeft:G,dateFormat:(l,s)=>{let t,d=new Date(s);const u={"Y+":d.getFullYear().toString(),"m+":(d.getMonth()+1).toString(),"d+":d.getDate().toString(),"H+":d.getHours().toString(),"M+":d.getMinutes().toString(),"S+":d.getSeconds().toString()};for(let _ in u)t=new RegExp("("+_+")").exec(l),t&&(l=l.replace(t[1],t[1].length==1?u[_]:u[_].padStart(t[1].length,"0")));return l},beforeDelete:T,beforeDeleteBQ:A,conservation:X}}},p=g=>(ue("data-v-47e57e16"),g=g(),_e(),g),ke={class:"container"},we={class:"header"},Ie={class:"content"},Ce=p(()=>a("span",{style:{"font-weight":"bold"}},"编号：",-1)),xe=p(()=>a("span",{style:{"font-weight":"bold"}},"重量：",-1)),De=p(()=>a("span",{style:{"font-weight":"bold"}},"标准：",-1)),Le=p(()=>a("span",{style:{"font-weight":"bold"}},"计量员：",-1)),je=p(()=>a("span",{style:{"font-weight":"bold"}},"扫描人：",-1)),Se=p(()=>a("span",{style:{"font-weight":"bold"}},"生产日期：",-1)),Fe=p(()=>a("span",{style:{color:"red"}},"*",-1)),Je=p(()=>a("span",{style:{color:"red"}},"*",-1)),Re={class:"van-uploader"},Be={class:"van-uploader__wrapper"},Ne={class:"van-image van-uploader__preview-image"},Ue=["src"],Pe=["onClick"],Ve=p(()=>a("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),Qe=[Ve],Oe=p(()=>a("i",{class:"van-badge__wrapper van-icon van-icon-photograph van-uploader__upload-icon"},null,-1)),Me=[Oe],Ye={key:0},Ee=p(()=>a("span",{style:{color:"red"}},"*",-1)),qe={class:"van-uploader"},Te={class:"van-uploader__wrapper"},He={class:"van-image van-uploader__preview-image"},ze=["src"],Ae=["onClick"],Ze=p(()=>a("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),Ge=[Ze],Xe=p(()=>a("i",{class:"van-badge__wrapper van-icon van-icon-photograph van-uploader__upload-icon"},null,-1)),Ke=[Xe],We={key:1},$e=p(()=>a("span",{style:{color:"red"}},"*",-1));function ea(g,n,k,e,w,L){const j=le,r=ie,I=re,S=de,C=me,x=fe,J=ce,D=pe,R=ve,V=ne,B=se;return v(),h("div",ke,[a("div",we,[c(j,{title:"品级质检",class:"page-nav-bar","left-arrow":"",onClickLeft:e.onClickLeft},null,8,["onClickLeft"])]),a("div",Ie,[c(R,{class:"box-card",shadow:"always"},{default:m(()=>[c(r,{"content-position":"left"},{default:m(()=>[y("基本信息")]),_:1}),a("div",null,[a("p",null,[Ce,a("span",null,b(e.listData.yjtJyInformationData.batchnumber),1)]),a("p",null,[xe,a("span",null,b(parseFloat(e.listData.yjtJyInformationData.suttle))+b(e.listData.yjtJyInformationData.unit),1)]),a("p",null,[De,a("span",null,b(e.listData.yjtJyInformationData.standard),1)]),a("p",null,[Le,a("span",null,b(e.listData.yjtJyInformationData.suttleperson),1),y("     "),je,a("span",null,b(e.listData.yjtJyInformationData.scanUser),1)]),a("p",null,[Se,a("span",null,b(e.dateFormat("YYYY-mm-dd HH:MM:SS",e.listData.yjtJyInformationData.proDate)),1)])]),a("div",null,[c(r,{"content-position":"left"},{default:m(()=>[Fe,y(b(e.typeCodeText),1)]),_:1}),c(S,{modelValue:e.typeCodeChecked,"onUpdate:modelValue":n[0]||(n[0]=o=>e.typeCodeChecked=o),direction:"horizontal"},{default:m(()=>[(v(!0),h(U,null,P(e.listData.typeCodeList,(o,F)=>(v(),M(I,{name:String(o.id)},{default:m(()=>[y(b(o.name),1)]),_:2},1032,["name"]))),256))]),_:1},8,["modelValue"])]),a("div",null,[c(r,{"content-position":"left"},{default:m(()=>[Je,y(" 质检照片")]),_:1}),a("div",Re,[a("div",Be,[(v(!0),h(U,null,P(e.fileList,(o,F)=>(v(),h("div",{class:"van-uploader__preview",key:o.index},[a("div",Ne,[a("img",{class:"van-image__img",src:o.base64Img,style:{"object-fit":"cover"},onClick:n[1]||(n[1]=(...f)=>e.seeImg&&e.seeImg(...f))},null,8,Ue)]),a("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:f=>e.beforeDelete(o.index,o.base64Img)},Qe,8,Pe)]))),128)),a("div",{class:"van-uploader__upload",onClick:n[2]||(n[2]=(...o)=>e.takePhotoZJ&&e.takePhotoZJ(...o))},Me)])])]),e.tabIndex==0?(v(),h("div",Ye,[c(r,{"content-position":"left"},{default:m(()=>[Ee,y(" 标签照片")]),_:1}),a("div",qe,[a("div",Te,[(v(!0),h(U,null,P(e.labelFileList,(o,F)=>(v(),h("div",{class:"van-uploader__preview",key:o.index},[a("div",He,[a("img",{class:"van-image__img",src:o.base64Img,style:{"object-fit":"cover"},onClick:n[3]||(n[3]=(...f)=>e.seeImgBQ&&e.seeImgBQ(...f))},null,8,ze)]),a("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:f=>e.beforeDeleteBQ(o.index,o.base64Img)},Ge,8,Ae)]))),128)),e.labelFileList.length!=1?(v(),h("div",{key:0,class:"van-uploader__upload",onClick:n[4]||(n[4]=(...o)=>e.takePhotoBQ&&e.takePhotoBQ(...o))},Ke)):O("",!0)])])])):O("",!0),e.tabIndex==1?(v(),h("div",We,[c(r,{"content-position":"left"},{default:m(()=>[$e,y("改判理由")]),_:1}),c(x,{modelValue:e.alterReason,"onUpdate:modelValue":n[5]||(n[5]=o=>e.alterReason=o),filterable:"",clearable:"","allow-create":"",placeholder:"改判理由",style:{width:"100%"}},{default:m(()=>[(v(!0),h(U,null,P(e.listData.alterReasonList,o=>(v(),M(C,{key:o.alterReason,label:o.alterReason,value:o.alterReason},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):O("",!0),a("div",null,[c(r,{"content-position":"left"},{default:m(()=>[y("备注")]),_:1}),c(D,{inset:""},{default:m(()=>[c(J,{modelValue:e.remarks,"onUpdate:modelValue":n[6]||(n[6]=o=>e.remarks=o),rows:"1",autosize:"",label:"备注",type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})])]),_:1}),c(V,{type:"primary",size:"large",style:{width:"80%",position:"absolute",left:"10%","margin-top":"15px","background-color":"#003363",color:"#FFFFFF"},onClick:e.conservation},{default:m(()=>[y("提交 ")]),_:1},8,["onClick"]),c(B,{show:e.showImage,"onUpdate:show":n[7]||(n[7]=o=>e.showImage=o),images:e.imgList,closeable:!0,loop:!1,closeOnPopstate:!0},null,8,["show","images"])])])}const ua=$(be,[["render",ea],["__scopeId","data-v-47e57e16"]]);export{ua as default};
