import{_ as z,u as A,H as Q,r as i,I as G,f as U,o as W,c as C,d as L,k as t,e as r,w as p,J as B,P as K,Q as T,N as X,Z as $,V as ee,W as I,l as v,F as P,O as M,g as Y,h as te,$ as ae,a5 as oe,a6 as le,a2 as ne,a3 as se,p as ie,j as re}from"./index-ecb86d45.js";import{E as de}from"./el-card-c7aba386.js";/* empty css              */import"./el-tag-f8ec1a70.js";import{E as ce,a as pe}from"./el-select-b7f3ea5a.js";import"./el-popper-81f3a1c7.js";/* empty css              *//* empty css              */import{d as ue,g as _e,b as me,e as ve}from"./gradeDetermination-1f495461.js";import"./index-95c1965a.js";import"./index-dd289210.js";function fe(_){let n=_.split(","),f=n[0].match(/:(.*?);/)[1],e=atob(n[1]),h=e.length,D=new Uint8Array(h);for(;h--;)D[h]=e.charCodeAt(h);let x=Math.random().toString(36).slice(-8),m=f.split("/")[1];return new File([D],x+"."+m,{type:f})}const he={setup(){const _=A(),n=Q(),f=i(""),e=i(""),h=i(""),D=i(""),x=i(""),m=i(""),g=i([]),S=i([]),y=i([]),R=i(!1),N=i(!1),j=i([]),c=G({yjtJyInformationData:{},typeCodeList:[],alterReasonList:[]}),b=i(!1);c.yjtJyInformationData=JSON.parse(decodeURIComponent(n.query.yjtJyInformation));const J=i(JSON.parse(decodeURIComponent(n.query.exterior))),l=i(JSON.parse(decodeURIComponent(n.query.tabIndex)));U.await("takePhoto",o=>{if(o!="null"){let s={};s.index=g.value.length+1,s.base64Img=o,g.value.push(s),S.value.push(o);let a=new FormData,d="/cathodeCopper/"+c.yjtJyInformationData.batchgroup+"/"+c.yjtJyInformationData.batchnumber;a.append("file",fe(o)),a.append("path",d),ue(a).then(k=>{let w={};w.fileName=k.data.fileName,w.fileUrl=k.data.fileUrl,w.index=g.value.length,y.value.push(w)}).catch(k=>{console.log(k)})}});const V=()=>{U.takePhoto()},F=(o,s)=>{y.value=y.value.filter(a=>a.index!=o),g.value=g.value.filter(a=>a.index!=o),S.value=S.value.filter(a=>a!=s)},q=()=>{j.value=S.value,R.value=!0};J.value=="1"?(f.value="qualified",e.value="合格品类型"):J.value=="2"&&(f.value="unqualified",e.value="不合格品类型"),W(()=>{U.register("goback",()=>{_.push({path:"/gradeDetermination"})}),E(f.value),O()});const H=()=>{_.push({path:"/gradeDetermination"})},Z=()=>{if(b.value=!0,y.value.length==0)return B({message:"请上传质检照片",type:"fail",overlay:!0,className:"particulars-detail-popup"}),b.value=!1,!1;if(l.value==1&&!D.value)return B({message:"请选择或者填写改判理由",type:"fail",overlay:!0,className:"particulars-detail-popup"}),b.value=!1,!1;K({duration:0,forbidClick:!0,className:"particulars-detail-popup",overlay:!0,message:"正在质检..."});let o={data:[],active:"",exterior:"",remarks:"",alterReason:"",typeCodeChecked:"",fileList:[],labelFileList:[]},s=[];s.push(c.yjtJyInformationData),o.data=s,o.typeCodeChecked=x.value,o.active=l.value,o.exterior=J.value,o.remarks=h.value,o.alterReason=D.value,o.fileList=y.value,ve(o).then(a=>{T(),a.data.code==200&&(B({message:"质检成功",type:"success",className:"particulars-detail-popup",overlay:!0}),b.value=!1,_.push({path:"/gradeDetermination",query:{barcode:c.yjtJyInformationData.barcode,tabState:"1"}}))}).catch(a=>{console.log(a),b.value=!1,T()})},E=o=>{let s={};s.typeCode=o,_e(s).then(a=>{a.data.code==200&&(c.typeCodeList=a.data.data,x.value=String(c.typeCodeList[0].id))}).catch(a=>{console.log(a)})},O=()=>{let o={},s={},a={};a.limit=9999,a.offset=1,a.blockId="paramBlock",a.data={},s.paramBlock=a,o.blocks=s,me(o).then(d=>{c.alterReasonList=d.data.blocks.resultBlock.data}).catch(d=>{console.log(d)})};return{imgList:j,showImage:R,showLabelImage:N,fileList:g,base64ImgList:S,imagePath:y,takePhotoState:m,alterReason:D,remarks:h,typeCode:f,typeCodeText:e,listData:c,exterior:J,tabIndex:l,typeCodeChecked:x,disabled:b,seeImg:q,takePhotoZJ:V,onClickLeft:H,dateFormat:(o,s)=>{let a,d=new Date(s);const k={"Y+":d.getFullYear().toString(),"m+":(d.getMonth()+1).toString(),"d+":d.getDate().toString(),"H+":d.getHours().toString(),"M+":d.getMinutes().toString(),"S+":d.getSeconds().toString()};for(let w in k)a=new RegExp("("+w+")").exec(o),a&&(o=o.replace(a[1],a[1].length==1?k[w]:k[w].padStart(a[1].length,"0")));return o},beforeDelete:F,conservation:Z,getTypeCodeData:E,getAlterReasonQuery:O}}},u=_=>(ie("data-v-48e7a5ac"),_=_(),re(),_),ge={class:"container"},ye={class:"header"},be={class:"content"},ke=u(()=>t("span",{style:{"font-weight":"bold"}},"编号：",-1)),we=u(()=>t("span",{style:{"font-weight":"bold"}},"重量：",-1)),Ce=u(()=>t("span",{style:{"font-weight":"bold"}},"标准：",-1)),Ie=u(()=>t("span",{style:{"font-weight":"bold"}},"计量员：",-1)),De=u(()=>t("span",{style:{"font-weight":"bold"}},"扫描人：",-1)),xe=u(()=>t("span",{style:{"font-weight":"bold"}},"生产日期：",-1)),Se=u(()=>t("span",{style:{color:"red"}},"*",-1)),Je=u(()=>t("span",{style:{color:"red"}},"*",-1)),Le={class:"van-uploader"},Re={class:"van-uploader__wrapper"},je={class:"van-image van-uploader__preview-image"},Fe=["src"],Ne=["onClick"],Ve=u(()=>t("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),Ue=[Ve],Be=u(()=>t("i",{class:"van-badge__wrapper van-icon van-icon-photograph van-uploader__upload-icon"},null,-1)),Pe=[Be],Me={key:0},Ee=u(()=>t("span",{style:{color:"red"}},"*",-1));function Oe(_,n,f,e,h,D){const x=X,m=ae,g=oe,S=le,y=ce,R=pe,N=ne,j=se,c=de,b=$,J=ee;return C(),L("div",ge,[t("div",ye,[r(x,{title:"品级质检",class:"page-nav-bar","left-arrow":"",onClickLeft:e.onClickLeft},null,8,["onClickLeft"])]),t("div",be,[r(c,{class:"box-card",shadow:"always"},{default:p(()=>[r(m,{"content-position":"left"},{default:p(()=>[I("基本信息")]),_:1}),t("div",null,[t("p",null,[ke,t("span",null,v(e.listData.yjtJyInformationData.batchnumber),1)]),t("p",null,[we,t("span",null,v(parseFloat(e.listData.yjtJyInformationData.suttle))+v(e.listData.yjtJyInformationData.unit),1)]),t("p",null,[Ce,t("span",null,v(e.listData.yjtJyInformationData.standard),1)]),t("p",null,[Ie,t("span",null,v(e.listData.yjtJyInformationData.suttleperson),1),I("      "),De,t("span",null,v(e.listData.yjtJyInformationData.scanUser),1)]),t("p",null,[xe,t("span",null,v(e.dateFormat("YYYY-mm-dd HH:MM:SS",e.listData.yjtJyInformationData.proDate)),1)])]),t("div",null,[r(m,{"content-position":"left"},{default:p(()=>[Se,I(v(e.typeCodeText),1)]),_:1}),r(S,{modelValue:e.typeCodeChecked,"onUpdate:modelValue":n[0]||(n[0]=l=>e.typeCodeChecked=l),direction:"horizontal"},{default:p(()=>[(C(!0),L(P,null,M(e.listData.typeCodeList,(l,V)=>(C(),Y(g,{name:String(l.id)},{default:p(()=>[I(v(l.name),1)]),_:2},1032,["name"]))),256))]),_:1},8,["modelValue"])]),t("div",null,[r(m,{"content-position":"left"},{default:p(()=>[Je,I(" 质检照片")]),_:1}),t("div",Le,[t("div",Re,[(C(!0),L(P,null,M(e.fileList,(l,V)=>(C(),L("div",{class:"van-uploader__preview",key:l.index},[t("div",je,[t("img",{class:"van-image__img",src:l.base64Img,style:{"object-fit":"cover"},onClick:n[1]||(n[1]=(...F)=>e.seeImg&&e.seeImg(...F))},null,8,Fe)]),t("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:F=>e.beforeDelete(l.index,l.base64Img)},Ue,8,Ne)]))),128)),t("div",{class:"van-uploader__upload",onClick:n[2]||(n[2]=(...l)=>e.takePhotoZJ&&e.takePhotoZJ(...l))},Pe)])])]),e.tabIndex==1?(C(),L("div",Me,[r(m,{"content-position":"left"},{default:p(()=>[Ee,I("改判理由")]),_:1}),r(R,{modelValue:e.alterReason,"onUpdate:modelValue":n[3]||(n[3]=l=>e.alterReason=l),filterable:"",clearable:"","allow-create":"",placeholder:"改判理由",style:{width:"100%"}},{default:p(()=>[(C(!0),L(P,null,M(e.listData.alterReasonList,l=>(C(),Y(y,{key:l.alterReason,label:l.alterReason,value:l.alterReason},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):te("",!0),t("div",null,[r(m,{"content-position":"left"},{default:p(()=>[I("备注")]),_:1}),r(j,{inset:""},{default:p(()=>[r(N,{modelValue:e.remarks,"onUpdate:modelValue":n[4]||(n[4]=l=>e.remarks=l),rows:"1",autosize:"",label:"备注",type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})])]),_:1}),r(b,{type:"primary",size:"large",disabled:e.disabled,style:{width:"80%",position:"absolute",left:"10%","margin-top":"15px","background-color":"#003363",color:"#FFFFFF"},onClick:e.conservation},{default:p(()=>[I("提交 ")]),_:1},8,["disabled","onClick"]),r(J,{show:e.showImage,"onUpdate:show":n[5]||(n[5]=l=>e.showImage=l),images:e.imgList,closeable:!0,loop:!1,closeOnPopstate:!0},null,8,["show","images"])])])}const $e=z(he,[["render",Oe],["__scopeId","data-v-48e7a5ac"]]);export{$e as default};
